<div class="scoreboard-container" *ngIf="awardState">
  <!-- Fireworks Animation -->
  <div class="fireworks" *ngIf="showFireworks">
    <div class="firework"></div>
    <div class="firework"></div>
    <div class="firework"></div>
  </div>

  <!-- Main Progress Section -->
  <div class="progress-section">
    <h1>Your Learning Progress</h1>
    
    <!-- Current Level Progress -->
    <div class="level-progress" (click)="toggleSection('level')">
      <div class="level-header">
        <h2>ğŸ“ Current Level Progress</h2>
        <span class="toggle-icon">{{ expandedSection === 'level' ? 'â–¼' : 'â–¶' }}</span>
      </div>
      
      <div class="level-info">
        <div class="level-number">Level {{ awardState.currentLevel }}</div>
        <div class="progress-bar">
          <div class="progress-fill" 
               [style.width.%]="awardState.levelProgress[awardState.currentLevel - 1].percentComplete">
          </div>
        </div>
        <div class="progress-text">
          {{ awardState.levelProgress[awardState.currentLevel - 1].itemsMastered }} 
          of 
          {{ awardState.levelProgress[awardState.currentLevel - 1].totalItems }}
        </div>
      </div>

      <!-- Expanded Level Details -->
      <div class="expanded-content" *ngIf="expandedSection === 'level'">
        <div class="level-stats">
          <h3>Level Progression</h3>
          <div class="level-list">
            <div class="level-item" *ngFor="let level of awardState.levelProgress">
              <span class="level-indicator" [ngClass]="{ 'completed': level.percentComplete === 100, 'active': level.level === awardState.currentLevel }">
                {{ level.level === awardState.currentLevel ? 'â–¶' : level.percentComplete === 100 ? 'âœ“' : 'â—‹' }}
              </span>
              <span class="level-name">Level {{ level.level }}</span>
              <span class="level-percentage">
                <span *ngIf="level.percentComplete === 0" style="color: red;">âœ—</span>
                <span *ngIf="level.percentComplete === 100" style="color: green;">âœ“</span>
                <span *ngIf="level.percentComplete > 0 && level.percentComplete < 100">{{ level.percentComplete.toFixed(0) }}%</span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Milestones Section -->
    <div class="milestones-section" (click)="toggleSection('milestones')">
      <div class="milestone-header">
        <h2>ğŸ† Milestones</h2>
        <span class="toggle-icon">{{ expandedSection === 'milestones' ? 'â–¼' : 'â–¶' }}</span>
      </div>
      
      <div class="milestone-row">
        <span>âœ“ Level 1 Master</span>
        <span>â–¶ Level 2 Working</span>
        <span>â³ Streak: {{ awardState.currentStreak }} days ğŸ”¥</span>
      </div>

      <div class="expanded-content" *ngIf="expandedSection === 'milestones'">
        <p>Keep practicing to unlock Level 3!</p>
      </div>
    </div>

    <!-- Weekly Progress -->
    <div class="weekly-progress" (click)="toggleSection('weekly')">
      <div class="weekly-header">
        <h2 class="header-title">ğŸ“ˆ This Week's Progress</h2>
        <span class="toggle-icon" [ngClass]="{'open': expandedSection === 'weekly'}">â–¶</span>
      </div>

      <div class="expanded-content" *ngIf="expandedSection === 'weekly'">
        <div class="daily-progress">
          <div class="day" *ngFor="let i of [0,1,2,3,4,5,6]">
            <div class="day-label">{{ ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'][i] }}</div>
            <div class="day-bar" [ngClass]="{'has-activity': awardState.weeklyProgress[i] > 0}" 
                 [style.height.%]="awardState.weeklyProgress[i]"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="recent-activity" (click)="toggleSection('activity')">
      <div class="activity-header">
        <h2>ğŸ“Š Recent Activity</h2>
        <span class="toggle-icon">{{ expandedSection === 'activity' ? 'â–¼' : 'â–¶' }}</span>
      </div>

      <div *ngIf="lastActivity" class="last-activity">
        <div class="activity-title">{{ lastActivity.title }}</div>
        <div class="activity-stats">
          <span>{{ lastActivity.path }} â€¢ Level {{ lastActivity.level }}</span>
          <span>Step {{ lastActivity.step }}/{{ lastActivity.totalSteps }}</span>
          <span *ngIf="lastActivity.step === lastActivity.totalSteps && lastActivity.result === 1">
            âœ“ Passed
          </span>
          <span *ngIf="lastActivity.step === lastActivity.totalSteps && lastActivity.result === 0">
            âœ— Failed
          </span>
          <span *ngIf="lastActivity.step < lastActivity.totalSteps">
            In Progress
          </span>
          <span *ngIf="awardState && awardState.recentActivities.length > 0">
            Avg: {{ (getAverageAccuracy(awardState.recentActivities) * 100).toFixed(0) }}%
          </span>
        </div>
        <div [ngClass]="getAccuracyClass(getAverageAccuracy(awardState.recentActivities))" class="accuracy-indicator">
          <div class="accuracy-bar" [style.width.%]="(lastActivity.step / lastActivity.totalSteps) * 100"></div>
        </div>
      </div>

      <div class="expanded-content" *ngIf="expandedSection === 'activity' && awardState.recentActivities.length > 0">
        <!-- Active Lesson Stopwatch -->
        <div *ngIf="awardState.activeLessonStopwatch" class="activity-item" style="background-color: #fff3cd; border-left: 4px solid #ffc107;">
          <div style="display: flex; flex-direction: column; flex: 1;">
            <span style="font-weight: 600;">â±ï¸ {{ awardState.activeLessonStopwatch.lessonTitle }}</span>
            <span style="font-size: 0.85em; color: #666;">
              Active â€¢ {{ formatTime(awardState.activeLessonStopwatch.elapsedSeconds) }}
            </span>
          </div>
          <span style="color: #ff9800; font-weight: 600;">In Progress...</span>
        </div>
        
        <!-- Paused Lessons -->
        <div *ngFor="let paused of awardState.pausedLessons" class="activity-item" style="background-color: #e3f2fd; border-left: 4px solid #2196F3;">
          <div style="display: flex; flex-direction: column; flex: 1;">
            <span style="font-weight: 600;">â¸ï¸ {{ paused.lessonTitle }}</span>
            <span style="font-size: 0.85em; color: #666;">
              Paused: {{ formatTime(paused.elapsedSeconds) }} â€¢ Step {{ paused.currentStep }}/{{ paused.totalSteps }}
            </span>
          </div>
          <button class="btn btn-small" style="background: #2196F3; color: white; padding: 5px 12px; border: none; border-radius: 4px; cursor: pointer;">
            â–¶ Resume
          </button>
        </div>
        
        <!-- Recent Activities List -->
        <div class="activity-list">
          <div class="activity-item" *ngFor="let activity of getUniqueActivities(awardState.recentActivities)">
            <div style="display: flex; flex-direction: column; flex: 1;">
              <span>{{ activity.title }}</span>
              <span style="font-size: 0.85em; color: #666;">
                {{ activity.timestampFormatted }}
              </span>
            </div>
            <span style="margin-right: 10px;">
              Avg: {{ (activity.avgAccuracy * 100).toFixed(0) }}%
            </span>
            <span *ngIf="activity.durationMinutes !== null" style="margin-right: 10px; color: #666;">
              â±ï¸ {{ activity.durationMinutes }} min
            </span>
            <span *ngIf="activity.hasFinishedAndPassed" style="color: green; font-size: 1.2em;">âœ“</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Medal Collection -->
    <div class="medals-section" (click)="toggleSection('medals')">
      <div class="medals-header">
        <h2>ğŸ–ï¸ Medals Earned</h2>
        <span class="toggle-icon">{{ expandedSection === 'medals' ? 'â–¼' : 'â–¶' }}</span>
      </div>

      <div class="medal-row">
        <div class="medal-item">
          <span class="medal-icon">ğŸ¥ˆ</span>
          <span class="medal-count">{{ awardState.medals.silver }}</span>
          <span class="medal-name">Silver</span>
        </div>
        <div class="medal-item">
          <span class="medal-icon">ğŸ¥‡</span>
          <span class="medal-count">{{ awardState.medals.gold }}</span>
          <span class="medal-name">Gold</span>
        </div>
        <div class="medal-item">
          <span class="medal-icon">ğŸ’</span>
          <span class="medal-count">{{ awardState.medals.platinum }}</span>
          <span class="medal-name">Platinum</span>
        </div>
        <div class="medal-item">
          <span class="medal-icon">ğŸ‘‘</span>
          <span class="medal-count">{{ awardState.medals.master }}</span>
          <span class="medal-name">Master</span>
        </div>
      </div>

      <div class="expanded-content" *ngIf="expandedSection === 'medals'">
        <p>ğŸ¥ˆ Silver: Earned on first quiz attempt</p>
        <p>ğŸ¥‡ Gold: Earned with 85%+ accuracy on replay</p>
        <p>ğŸ’ Platinum: Earned with 95%+ accuracy on replay</p>
        <p>ğŸ‘‘ Master: Earned with 100% on 3+ replays</p>
      </div>
    </div>

    <!-- Voice Feedback -->
    <button class="voice-button" (click)="playVoiceFeedback()">
      ğŸ”Š Play Voice Feedback
    </button>
  </div>
</div>
