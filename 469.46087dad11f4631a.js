(self.webpackChunklearnlao=self.webpackChunklearnlao||[]).push([[469],{8993:(ln,Ye,L)=>{"use strict";L.d(Ye,{db:()=>re});var U=L(5505);const A=Symbol.for("Dexie"),F=globalThis[A]||(globalThis[A]=U);if(U.semVer!==F.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${U.semVer} and ${F.semVer}`);const Be=F,re=new class it extends Be{constructor(){super("LaoLearningDB"),this.version(1).stores({vocab:"id, category, usage_rank, english",progress:"id, due, state, [state+due]"})}}},5505:function(ln){ln.exports=function(){"use strict";var Ye=function(e,t){return(Ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])})(e,t)},L=function(){return(L=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function U(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var A=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,F=Object.keys,W=Array.isArray;function ie(e,t){return"object"!=typeof t||F(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||A.Promise||(A.Promise=Promise);var Ke=Object.getPrototypeOf,qe={}.hasOwnProperty;function ue(e,t){return qe.call(e,t)}function ke(e,t){"function"==typeof t&&(t=t(Ke(e))),(typeof Reflect>"u"?F:Reflect.ownKeys)(t).forEach(function(n){Pe(e,n,t[n])})}var pt=Object.defineProperty;function Pe(e,t,n,r){pt(e,t,ie(n&&ue(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Ne(e){return{from:function(t){return e.prototype=Object.create(t.prototype),Pe(e.prototype,"constructor",e),{extend:ke.bind(null,e.prototype)}}}}var fn=Object.getOwnPropertyDescriptor,Mt=[].slice;function Be(e,t,n){return Mt.call(e,t,n)}function it(e,t){return t(e)}function re(e){if(!e)throw new Error("Assertion Failed")}function yt(e){A.setImmediate?setImmediate(e):setTimeout(e,0)}function Se(e,t){if("string"==typeof t&&ue(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var a=Se(e,t[r]);n.push(a)}return n}var s=t.indexOf(".");if(-1!==s){var u=e[t.substr(0,s)];return null==u?void 0:Se(u,t.substr(s+1))}}function he(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){re("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)he(e,t[r],n[r])}else{var a,s,u=t.indexOf(".");-1!==u?(a=t.substr(0,u),""===(s=t.substr(u+1))?void 0===n?W(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n:he(u=(u=e[a])&&ue(e,a)?u:e[a]={},s,n)):void 0===n?W(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Kt(e){var t,n={};for(t in e)ue(e,t)&&(n[t]=e[t]);return n}var Hn=[].concat;function We(e){return Hn.apply([],e)}var c="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(We([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return A[e]}),mt=new Set(c.map(function(e){return A[e]})),Qe=null;function De(e){return Qe=new WeakMap,e=function t(n){if(!n||"object"!=typeof n)return n;var r=Qe.get(n);if(r)return r;if(W(n)){Qe.set(n,r=[]);for(var i=0,a=n.length;i<a;++i)r.push(t(n[i]))}else if(mt.has(n.constructor))r=n;else{var s,u=Ke(n);for(s in r=u===Object.prototype?{}:Object.create(u),Qe.set(n,r),n)ue(n,s)&&(r[s]=t(n[s]))}return r}(e),Qe=null,e}var hn={}.toString;function Dt(e){return hn.call(e).slice(8,-1)}var vt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",dn="symbol"==typeof vt?function(e){var t;return null!=e&&(t=e[vt])&&t.apply(e)}:function(){return null};function Ie(e,t){return 0<=(t=e.indexOf(t))&&e.splice(t,1),0<=t}var Ee={};function Oe(e){var t,n,r,i;if(1===arguments.length){if(W(e))return e.slice();if(this===Ee&&"string"==typeof e)return[e];if(i=dn(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"!=typeof(t=e.length))return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var gt=typeof Symbol<"u"?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},xe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(o=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"]),Yn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ce(e,t){this.name=e,this.message=t}function pn(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join("\n")}function Ce(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=pn(e,t)}function Re(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=pn(e,this.failures)}Ne(ce).from(Error).extend({toString:function(){return this.name+": "+this.message}}),Ne(Ce).from(ce),Ne(Re).from(ce);var It=xe.reduce(function(e,t){return e[t]=t+"Error",e},{}),Ct=ce,B=xe.reduce(function(e,t){var n=t+"Error";function r(i,a){this.name=n,i?"string"==typeof i?(this.message="".concat(i).concat(a?"\n "+a:""),this.inner=a||null):"object"==typeof i&&(this.message="".concat(i.name," ").concat(i.message),this.inner=i):(this.message=Yn[t]||n,this.inner=null)}return Ne(r).from(Ct),e[t]=r,e},{});B.Syntax=SyntaxError,B.Type=TypeError,B.Range=RangeError;var Rt=o.reduce(function(e,t){return e[t+"Error"]=B[t],e},{}),Le=xe.reduce(function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=B[t]),e},{});function Z(){}function je(e){return e}function jt(e,t){return null==e||e===je?t:function(n){return t(e(n))}}function _e(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Tt(e,t){return e===Z?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?_e(r,this.onsuccess):r),i&&(this.onerror=this.onerror?_e(i,this.onerror):i),void 0!==a?a:n}}function bt(e,t){return e===Z?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?_e(n,this.onsuccess):n),r&&(this.onerror=this.onerror?_e(r,this.onerror):r)}}function yn(e,t){return e===Z?t:function(n){var r=e.apply(this,arguments);ie(n,r);var i=this.onsuccess,a=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?_e(i,this.onsuccess):i),a&&(this.onerror=this.onerror?_e(a,this.onerror):a),void 0===r?void 0===n?void 0:n:ie(r,n)}}function Ft(e,t){return e===Z?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function at(e,t){return e===Z?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}Le.ModifyError=Ce,Le.DexieError=ce,Le.BulkError=Re;var we=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function qt(e){we=e}var o,Xe={},S=100,p=(xe=(xe=(c=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Ke(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Ke(t),e]}())[1])&&xe.then,(o=c[0])&&o.constructor),_=!!(c=c[2]),x=function(e,t){te.push([e,t]),j&&(queueMicrotask(Mr),j=!1)},P=!0,j=!0,$=[],V=[],J=je,ae={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Z,pgp:!1,env:{},finalize:Z},q=ae,te=[],de=0,Nt=[];function T(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=q;if("function"!=typeof e){if(e!==Xe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&vn(this,this._value))}this._state=null,this._value=null,++t.ref,function n(r,i){try{i(function(a){if(null===r._state){if(a===r)throw new TypeError("A promise cannot be resolved with itself.");var s=r._lib&&ot();a&&"function"==typeof a.then?n(r,function(u,f){a instanceof T?a._then(u,f):a.then(u,f)}):(r._state=!0,r._value=a,Qn(r)),s&&st()}},vn.bind(null,r))}catch(a){vn(r,a)}}(this,e)}var mn={get:function(){var e=q,t=Ut;function n(r,i){var a=this,s=!e.global&&(e!==q||t!==Ut),u=s&&!Ue(),f=new T(function(h,v){gn(a,new Wn(Zn(r,e,s,u),Zn(i,e,s,u),h,v,e))});return this._consoleTask&&(f._consoleTask=this._consoleTask),f}return n.prototype=Xe,n},set:function(e){Pe(this,"then",e&&e.prototype===Xe?mn:{get:function(){return e},set:mn.set})}};function Wn(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function vn(e,t){var n,r;V.push(t),null===e._state&&(n=e._lib&&ot(),t=J(t),e._state=!1,e._value=t,r=e,$.some(function(i){return i._value===r._value})||$.push(r),Qn(e),n&&st())}function Qn(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)gn(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===de&&(++de,x(function(){0==--de&&bn()},[]))}function gn(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++de,x(Ar,[n,e,t])}else e._listeners.push(t)}function Ar(e,t,n){try{var r,i=t._value;!t._state&&V.length&&(V=[]),r=we&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||-1!==V.indexOf(i)||function(a){for(var s=$.length;s;)if($[--s]._value===a._value)return $.splice(s,1)}(t),n.resolve(r)}catch(a){n.reject(a)}finally{0==--de&&bn(),--n.psd.ref||n.psd.finalize()}}function Mr(){Ze(ae,function(){ot()&&st()})}function ot(){var e=P;return j=P=!1,e}function st(){var e,t,n;do{for(;0<te.length;)for(e=te,te=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(0<te.length);j=P=!0}function bn(){var e=$;$=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var t=Nt.slice(0),n=t.length;n;)t[--n]()}function Bt(e){return new T(Xe,!1,e)}function ne(e,t){var n=q;return function(){var r=ot(),i=q;try{return ze(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{ze(i,!1),r&&st()}}}ke(T.prototype,{then:mn,_then:function(e,t){gn(this,new Wn(null,null,e,t,q))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=e,n=arguments[1];return this.then(null,"function"==typeof t?function(r){return(r instanceof t?n:Bt)(r)}:function(r){return(r&&r.name===t?n:Bt)(r)})},finally:function(e){return this.then(function(t){return T.resolve(e()).then(function(){return t})},function(t){return T.resolve(e()).then(function(){return Bt(t)})})},timeout:function(e,t){var n=this;return e<1/0?new T(function(r,i){var a=setTimeout(function(){return i(new B.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Pe(T.prototype,Symbol.toStringTag,"Dexie.Promise"),ae.env=Xn(),ke(T,{all:function(){var e=Oe.apply(null,arguments).map(zt);return new T(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(function(i,a){return T.resolve(i).then(function(s){e[a]=s,--r||t(e)},n)})})},resolve:function(e){return e instanceof T?e:e&&"function"==typeof e.then?new T(function(t,n){e.then(t,n)}):new T(Xe,!0,e)},reject:Bt,race:function(){var e=Oe.apply(null,arguments).map(zt);return new T(function(t,n){e.map(function(r){return T.resolve(r).then(t,n)})})},PSD:{get:function(){return q},set:function(e){return q=e}},totalEchoes:{get:function(){return Ut}},newPSD:$e,usePSD:Ze,scheduler:{get:function(){return x},set:function(e){x=e}},rejectionMapper:{get:function(){return J},set:function(e){J=e}},follow:function(e,t){return new T(function(n,r){return $e(function(i,a){var s=q;s.unhandleds=[],s.onunhandled=a,s.finalize=_e(function(){var u,f=this;u=function(){0===f.unhandleds.length?i():a(f.unhandleds[0])},Nt.push(function h(){u(),Nt.splice(Nt.indexOf(h),1)}),++de,x(function(){0==--de&&bn()},[])},s.finalize),e()},t,n,r)})}}),p&&(p.allSettled&&Pe(T,"allSettled",function(){var e=Oe.apply(null,arguments).map(zt);return new T(function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach(function(i,a){return T.resolve(i).then(function(s){return r[a]={status:"fulfilled",value:s}},function(s){return r[a]={status:"rejected",reason:s}}).then(function(){return--n||t(r)})})})}),p.any&&typeof AggregateError<"u"&&Pe(T,"any",function(){var e=Oe.apply(null,arguments).map(zt);return new T(function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(a,s){return T.resolve(a).then(function(u){return t(u)},function(u){i[s]=u,--r||n(new AggregateError(i))})})})}),p.withResolvers&&(T.withResolvers=p.withResolvers));var le={awaits:0,echoes:0,id:0},Kr=0,Lt=[],$t=0,Ut=0,Dr=0;function $e(e,t,n,r){var i=q,a=Object.create(i);return a.parent=i,a.ref=0,a.global=!1,a.id=++Dr,a.env=_?{Promise:T,PromiseProp:{value:T,configurable:!0,writable:!0},all:T.all,race:T.race,allSettled:T.allSettled,any:T.any,resolve:T.resolve,reject:T.reject}:{},t&&ie(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()},r=Ze(a,e,n,r),0===a.ref&&a.finalize(),r}function ut(){return le.id||(le.id=++Kr),++le.awaits,le.echoes+=S,le.id}function Ue(){return!!le.awaits&&(0==--le.awaits&&(le.id=0),le.echoes=le.awaits*S,!0)}function zt(e){return le.echoes&&e&&e.constructor===p?(ut(),e.then(function(t){return Ue(),t},function(t){return Ue(),oe(t)})):e}function Ir(){var e=Lt[Lt.length-1];Lt.pop(),ze(e,!1)}function ze(e,t){var n,r=q;(t?!le.echoes||$t++&&e===q:!$t||--$t&&e===q)||queueMicrotask(t?function(i){++Ut,le.echoes&&0!=--le.echoes||(le.echoes=le.awaits=le.id=0),Lt.push(q),ze(i,!0)}.bind(null,e):Ir),e!==q&&(q=e,r===ae&&(ae.env=Xn()),_&&(n=ae.env.Promise,t=e.env,(r.global||e.global)&&(Object.defineProperty(A,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function Xn(){var e=A.Promise;return _?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(A,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Ze(e,t,n,r,i){var a=q;try{return ze(e,!0),t(n,r,i)}finally{ze(a,!1)}}function Zn(e,t,n,r){return"function"!=typeof e?e:function(){var i=q;n&&ut(),ze(t,!0);try{return e.apply(this,arguments)}finally{ze(i,!1),r&&queueMicrotask(Ue)}}}function _n(e){Promise===p&&0===le.echoes?0===$t?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+xe).indexOf("[native code]")&&(ut=Ue=Z);var oe=T.reject,Te="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Jn="String expected.",ct=[],Gt="__dbnames",wn="readonly",xn="readwrite";function et(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var er={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Vt(e){return"string"!=typeof e||/\./.test(e)?function(t){return t}:function(t){return void 0===t[e]&&e in t&&delete(t=De(t))[e],t}}function tr(){throw B.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Q(e,t){try{var n=nr(e),r=nr(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(i,a){for(var s=i.length,u=a.length,f=s<u?s:u,h=0;h<f;++h)if(i[h]!==a[h])return i[h]<a[h]?-1:1;return s===u?0:s<u?-1:1}(rr(e),rr(t));case"Array":return function(i,a){for(var s=i.length,u=a.length,f=s<u?s:u,h=0;h<f;++h){var v=Q(i[h],a[h]);if(0!==v)return v}return s===u?0:s<u?-1:1}(e,t)}}catch{}return NaN}function nr(e){var t=typeof e;return"object"!=t?t:ArrayBuffer.isView(e)||"ArrayBuffer"===(e=Dt(e))?"binary":e}function rr(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Ht(e,t,n){var r=e.schema.yProps;return r?(t&&0<n.numFailures&&(t=t.filter(function(i,a){return!n.failures[a]})),Promise.all(r.map(function(i){return i=i.updatesTable,t?e.db.table(i).where("k").anyOf(t).delete():e.db.table(i).clear()})).then(function(){return n})):n}var _t=(ir.prototype.execute=function(e){var t=this["@@propmod"];if(void 0!==t.add){var n=t.add;if(W(n))return U(U([],W(e)?e:[],!0),n,!0).sort();if("number"==typeof n)return(Number(e)||0)+n;if("bigint"==typeof n)try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(void 0!==t.remove){var r=t.remove;if(W(r))return W(e)?e.filter(function(i){return!r.includes(i)}).sort():[];if("number"==typeof r)return Number(e)-r;if("bigint"==typeof r)try{return BigInt(e)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return(n=null===(n=t.replacePrefix)||void 0===n?void 0:n[0])&&"string"==typeof e&&e.startsWith(n)?t.replacePrefix[1]+e.substring(n.length):e},ir);function ir(e){this["@@propmod"]=e}function ar(e,t){for(var n=F(t),r=n.length,i=!1,a=0;a<r;++a){var s=n[a],u=t[s],f=Se(e,s);u instanceof _t?(he(e,s,u.execute(f)),i=!0):f!==u&&(he(e,s,u),i=!0)}return i}var or=(ee.prototype._trans=function(e,t,n){var r=this._tx||q.trans,i=this.name,a=we&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===e?"read":"write"," ").concat(this.name));function s(h,v,l){if(!l.schema[i])throw new B.NotFound("Table "+i+" not part of transaction");return t(l.idbtrans,l)}var u=ot();try{var f=r&&r.db._novip===this.db._novip?r===q.trans?r._promise(e,s,n):$e(function(){return r._promise(e,s,n)},{trans:r,transless:q.transless||q}):function h(v,l,b,d){if(v.idbdb&&(v._state.openComplete||q.letThrough||v._vip)){var y=v._createTransaction(l,b,v._dbSchema);try{y.create(),v._state.PR1398_maxLoop=3}catch(m){return m.name===It.InvalidState&&v.isOpen()&&0<--v._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),v.close({disableAutoOpen:!1}),v.open().then(function(){return h(v,l,b,d)})):oe(m)}return y._promise(l,function(m,g){return $e(function(){return q.trans=y,d(m,g,y)})}).then(function(m){if("readwrite"===l)try{y.idbtrans.commit()}catch{}return"readonly"===l?m:y._completion.then(function(){return m})})}if(v._state.openComplete)return oe(new B.DatabaseClosed(v._state.dbOpenError));if(!v._state.isBeingOpened){if(!v._state.autoOpen)return oe(new B.DatabaseClosed);v.open().catch(Z)}return v._state.dbReadyPromise.then(function(){return h(v,l,b,d)})}(this.db,e,[this.name],s);return a&&(f._consoleTask=a,f=f.catch(function(h){return console.trace(h),oe(h)})),f}finally{u&&st()}},ee.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):null==e?oe(new B.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:e}).then(function(i){return n.hook.reading.fire(i)})}).then(t)},ee.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(W(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=F(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(u){if(u.compound&&t.every(function(h){return 0<=u.keyPath.indexOf(h)})){for(var f=0;f<t.length;++f)if(-1===t.indexOf(u.keyPath[f]))return!1;return!0}return!1}).sort(function(u,f){return u.keyPath.length-f.keyPath.length})[0];if(n&&"\uffff"!==this.db._maxKey){var a=n.keyPath.slice(0,t.length);return this.where(a).equals(a.map(function(f){return e[f]}))}!n&&we&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var r=this.schema.idxByName;function i(u,f){return 0===Q(u,f)}a=(s=t.reduce(function(l,f){var h=l[0],v=l[1],b=(l=r[f],e[f]);return[h||l,h||!l?et(v,l&&l.multi?function(d){return d=Se(d,f),W(d)&&d.some(function(y){return i(b,y)})}:function(d){return i(b,Se(d,f))}):v]},[null,null]))[0];var s=s[1];return a?this.where(a.name).equals(e[a.keyPath]).filter(s):n?this.filter(s):this.where(t).equals("")},ee.prototype.filter=function(e){return this.toCollection().and(e)},ee.prototype.count=function(e){return this.toCollection().count(e)},ee.prototype.offset=function(e){return this.toCollection().offset(e)},ee.prototype.limit=function(e){return this.toCollection().limit(e)},ee.prototype.each=function(e){return this.toCollection().each(e)},ee.prototype.toArray=function(e){return this.toCollection().toArray(e)},ee.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ee.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,W(e)?"[".concat(e.join("+"),"]"):e))},ee.prototype.reverse=function(){return this.toCollection().reverse()},ee.prototype.mapToClass=function(e){var t,n=this.db,r=this.name;function i(){return null!==t&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof tr&&(function(f,h){if("function"!=typeof h&&null!==h)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function v(){this.constructor=f}Ye(f,h),f.prototype=null===h?Object.create(h):(v.prototype=h.prototype,new v)}(i,t=e),Object.defineProperty(i.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),i.prototype.table=function(){return r},e=i);for(var a=new Set,s=e.prototype;s;s=Ke(s))Object.getOwnPropertyNames(s).forEach(function(f){return a.add(f)});function u(f){if(!f)return f;var h,v=Object.create(e.prototype);for(h in f)if(!a.has(h))try{v[h]=f[h]}catch{}return v}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=u,this.hook("reading",u),e},ee.prototype.defineClass=function(){return this.mapToClass(function(e){ie(this,e)})},ee.prototype.add=function(e,t){var n=this,r=this.schema.primKey,a=r.keyPath,s=e;return a&&r.auto&&(s=Vt(a)(e)),this._trans("readwrite",function(u){return n.core.mutate({trans:u,type:"add",keys:null!=t?[t]:null,values:[s]})}).then(function(u){return u.numFailures?T.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{he(e,a,u)}catch{}return u})},ee.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(i){return n.core.get({trans:i,key:e}).then(function(a){var s=a??{};return ar(s,t),r&&he(s,r,e),n.core.mutate({trans:i,type:"put",values:[s],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(u){return u.numFailures?T.reject(u.failures[0]):!!a})})})},ee.prototype.update=function(e,t){return"object"!=typeof e||W(e)?this.where(":id").equals(e).modify(t):void 0===(e=Se(e,this.schema.primKey.keyPath))?oe(new B.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t)},ee.prototype.put=function(e,t){var n=this,r=this.schema.primKey,a=r.keyPath,s=e;return a&&r.auto&&(s=Vt(a)(e)),this._trans("readwrite",function(u){return n.core.mutate({trans:u,type:"put",values:[s],keys:null!=t?[t]:null})}).then(function(u){return u.numFailures?T.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{he(e,a,u)}catch{}return u})},ee.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(r){return Ht(t,[e],r)}).then(function(r){return r.numFailures?T.reject(r.failures[0]):void 0})})},ee.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:er}).then(function(n){return Ht(e,null,n)})}).then(function(t){return t.numFailures?T.reject(t.failures[0]):void 0})},ee.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(r){return r.map(function(i){return t.hook.reading.fire(i)})})})},ee.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(s){var u=(h=r.schema.primKey).auto;if((h=h.keyPath)&&i)throw new B.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");var f=e.length,h=h&&u?e.map(Vt(h)):e;return r.core.mutate({trans:s,type:"add",keys:i,values:h,wantResults:a}).then(function(y){var l=y.numFailures,b=y.results,d=y.lastResult;if(y=y.failures,0===l)return a?b:d;throw new Re("".concat(r.name,".bulkAdd(): ").concat(l," of ").concat(f," operations failed"),y)})})},ee.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(s){var u=(h=r.schema.primKey).auto;if((h=h.keyPath)&&i)throw new B.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");var f=e.length,h=h&&u?e.map(Vt(h)):e;return r.core.mutate({trans:s,type:"put",keys:i,values:h,wantResults:a}).then(function(y){var l=y.numFailures,b=y.results,d=y.lastResult;if(y=y.failures,0===l)return a?b:d;throw new Re("".concat(r.name,".bulkPut(): ").concat(l," of ").concat(f," operations failed"),y)})})},ee.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(s){return s.key}),i=e.map(function(s){return s.changes}),a=[];return this._trans("readwrite",function(s){return n.getMany({trans:s,keys:r,cache:"clone"}).then(function(u){var f=[],h=[];e.forEach(function(l,b){var d=l.key,y=l.changes,m=u[b];if(m){for(var g=0,w=Object.keys(y);g<w.length;g++){var k=w[g],E=y[k];if(k===t.schema.primKey.keyPath){if(0!==Q(E,d))throw new B.Constraint("Cannot update primary key in bulkUpdate()")}else he(m,k,E)}a.push(b),f.push(d),h.push(m)}});var v=f.length;return n.mutate({trans:s,type:"put",keys:f,values:h,updates:{keys:r,changeSpecs:i}}).then(function(l){var b=l.numFailures,d=l.failures;if(0===b)return v;for(var y=0,m=Object.keys(d);y<m.length;y++){var g,w=m[y],k=a[Number(w)];null!=k&&(g=d[w],delete d[w],d[k]=g)}throw new Re("".concat(t.name,".bulkUpdate(): ").concat(b," of ").concat(v," operations failed"),d)})})})},ee.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:e}).then(function(i){return Ht(t,e,i)})}).then(function(s){var i=s.numFailures,a=s.lastResult;if(s=s.failures,0===i)return a;throw new Re("".concat(t.name,".bulkDelete(): ").concat(i," of ").concat(n," operations failed"),s)})},ee);function ee(){}function wt(e){function t(s,u){if(u){for(var f=arguments.length,h=new Array(f-1);--f;)h[f-1]=arguments[f];return n[s].subscribe.apply(null,h),e}if("string"==typeof s)return n[s]}var n={};t.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return t;function a(s,u,f){if("object"!=typeof s){var h;u=u||Ft;var v={subscribers:[],fire:f=f||Z,subscribe:function(l){-1===v.subscribers.indexOf(l)&&(v.subscribers.push(l),v.fire=u(v.fire,l))},unsubscribe:function(l){v.subscribers=v.subscribers.filter(function(b){return b!==l}),v.fire=v.subscribers.reduce(u,f)}};return n[s]=t[s]=v}F(h=s).forEach(function(l){var b=h[l];if(W(b))a(l,h[l][0],h[l][1]);else{if("asap"!==b)throw new B.InvalidArgument("Invalid event config");var d=a(l,je,function(){for(var y=arguments.length,m=new Array(y);y--;)m[y]=arguments[y];d.subscribers.forEach(function(g){yt(function(){g.apply(null,m)})})})}})}}function xt(e,t){return Ne(t).from({prototype:e}),t}function lt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function kn(e,t){e.filter=et(e.filter,t)}function Sn(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return et(r(),t())}:t,e.justLimit=n&&!r}function Yt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new B.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function sr(e,t,n){var r=Yt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Wt(e,t,n,r){var i=e.replayFilter?et(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},s=function(u,f,h){var v,l;i&&!i(f,h,function(b){return f.stop(b)},function(b){return f.fail(b)})||("[object ArrayBuffer]"==(l=""+(v=f.primaryKey))&&(l=""+new Uint8Array(v)),ue(a,l)||(a[l]=!0,t(u,f,h)))};return Promise.all([e.or._iterate(s,n),ur(sr(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return ur(sr(e,r,n),et(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function ur(e,t,n,r){var i=ne(r?function(a,s,u){return n(r(a),s,u)}:n);return e.then(function(a){if(a)return a.start(function(){var s=function(){return a.continue()};t&&!t(a,function(u){return s=u},function(u){a.stop(u),s=Z},function(u){a.fail(u),s=Z})||i(a.value,a,function(u){return s=u}),s()})})}var Cr=(X.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,oe.bind(null,n.error)):n.table._trans("readonly",e).then(t)},X.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,oe.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},X.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=et(t.algorithm,e)},X.prototype._iterate=function(e,t){return Wt(this._ctx,e,t,this._ctx.table.core)},X.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&ie(n,e),t._ctx=n,t},X.prototype.raw=function(){return this._ctx.valueMapper=null,this},X.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Wt(t,e,n,t.table.core)})},X.prototype.count=function(e){var t=this;return this._read(function(n){var r=t._ctx,i=r.table.core;if(lt(r,!0))return i.count({trans:n,query:{index:Yt(r,i.schema),range:r.range}}).then(function(s){return Math.min(s,r.limit)});var a=0;return Wt(r,function(){return++a,!1},n,i).then(function(){return a})}).then(e)},X.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function a(f,h){return h?a(f[n[h]],h-1):f[r]}var s="next"===this._ctx.dir?1:-1;function u(f,h){return Q(a(f,i),a(h,i))*s}return this.toArray(function(f){return f.sort(u)}).then(t)},X.prototype.toArray=function(e){var t=this;return this._read(function(n){var r=t._ctx;if("next"===r.dir&&lt(r,!0)&&0<r.limit){var i=r.valueMapper,a=Yt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:a,range:r.range}}).then(function(u){return u=u.result,i?u.map(i):u})}var s=[];return Wt(r,function(u){return s.push(u)},n,r.table.core).then(function(){return s})},e)},X.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,lt(t)?Sn(t,function(){var n=e;return function(r,i){return 0===n||(1===n?--n:i(function(){r.advance(n),n=0}),!1)}}):Sn(t,function(){var n=e;return function(){return--n<0}})),this},X.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Sn(this._ctx,function(){var t=e;return function(n,r,i){return--t<=0&&r(i),0<=t}},!0),this},X.prototype.until=function(e,t){return kn(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},X.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},X.prototype.last=function(e){return this.reverse().first(e)},X.prototype.filter=function(e){var t;return kn(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=et(t.isMatch,e),this},X.prototype.and=function(e){return this.filter(e)},X.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},X.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},X.prototype.desc=function(){return this.reverse()},X.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.key,r)})},X.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},X.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.primaryKey,r)})},X.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,i){n.push(i.key)}).then(function(){return n}).then(e)},X.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&lt(t,!0)&&0<t.limit)return this._read(function(r){var i=Yt(t,t.table.core.schema);return t.table.core.query({trans:r,values:!1,limit:t.limit,query:{index:i,range:t.range}})}).then(function(r){return r.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,i){n.push(i.primaryKey)}).then(function(){return n}).then(e)},X.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},X.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},X.prototype.lastKey=function(e){return this.reverse().firstKey(e)},X.prototype.distinct=function(){var e;if(!(e=(e=this._ctx).index&&e.table.schema.idxByName[e.index])||!e.multi)return this;var t={};return kn(this._ctx,function(i){var r=i.primaryKey.toString();return i=ue(t,r),t[r]=!0,!i}),this},X.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var h,i="function"==typeof e?e:function(m){return ar(m,e)},a=n.table.core,s=(h=a.schema.primaryKey).outbound,u=h.extractKey,f=200;function v(m,k){var w=k.failures;b+=m-(k=k.numFailures);for(var E=0,O=F(w);E<O.length;E++)l.push(w[O[E]])}(h=t.db._options.modifyChunkSize)&&(f="object"==typeof h?h[a.name]||h["*"]||200:h);var l=[],b=0,d=[],y=e===cr;return t.clone().primaryKeys().then(function(m){var w=lt(n)&&n.limit===1/0&&("function"!=typeof e||y)&&{index:n.index,range:n.range};return function g(k){var E=Math.min(f,m.length-k),O=m.slice(k,k+E);return(y?Promise.resolve([]):a.getMany({trans:r,keys:O,cache:"immutable"})).then(function(K){var C=[],M=[],D=s?[]:null,R=y?O:[];if(!y)for(var I=0;I<E;++I){var N=K[I],G={value:De(N),primKey:m[k+I]};!1!==i.call(G,G.value,G)&&(null==G.value?R.push(m[k+I]):s||0===Q(u(N),u(G.value))?(M.push(G.value),s&&D.push(m[k+I])):(R.push(m[k+I]),C.push(G.value)))}return Promise.resolve(0<C.length&&a.mutate({trans:r,type:"add",values:C}).then(function(H){for(var Y in H.failures)R.splice(parseInt(Y),1);v(C.length,H)})).then(function(){return(0<M.length||w&&"object"==typeof e)&&a.mutate({trans:r,type:"put",keys:D,values:M,criteria:w,changeSpec:"function"!=typeof e&&e,isAdditionalChunk:0<k}).then(function(H){return v(M.length,H)})}).then(function(){return(0<R.length||w&&y)&&a.mutate({trans:r,type:"delete",keys:R,criteria:w,isAdditionalChunk:0<k}).then(function(H){return Ht(n.table,R,H)}).then(function(H){return v(R.length,H)})}).then(function(){return m.length>k+E&&g(k+f)})})}(0).then(function(){if(0<l.length)throw new Ce("Error modifying one or more objects",l,b,d);return m.length})})})},X.prototype.delete=function(){var e=this._ctx,t=e.range;return!lt(e)||e.table.schema.yProps||!e.isPrimKey&&3!==t.type?this.modify(cr):this._write(function(n){var i=t;return e.table.core.count({trans:n,query:{index:e.table.core.schema.primaryKey,range:i}}).then(function(a){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(function(f){var u=f.failures;if(f=f.numFailures)throw new Ce("Could not delete some values",Object.keys(u).map(function(h){return u[h]}),a-f);return a-f})})})},X);function X(){}var cr=function(e,t){return t.value=null};function Rr(e,t){return e<t?-1:e===t?0:1}function jr(e,t){return t<e?-1:e===t?0:1}function ge(e,t,n){return(e=e instanceof fr?new e.Collection(e):e)._ctx.error=new(n||TypeError)(t),e}function ft(e){return new e.Collection(e,function(){return lr("")}).limit(0)}function Qt(e,t,n,r){var i,a,s,u,f,h,v,l=n.length;if(!n.every(function(y){return"string"==typeof y}))return ge(e,Jn);function b(y){i="next"===y?function(g){return g.toUpperCase()}:function(g){return g.toLowerCase()},a="next"===y?function(g){return g.toLowerCase()}:function(g){return g.toUpperCase()},s="next"===y?Rr:jr;var m=n.map(function(g){return{lower:a(g),upper:i(g)}}).sort(function(g,w){return s(g.lower,w.lower)});u=m.map(function(g){return g.upper}),f=m.map(function(g){return g.lower}),v="next"===(h=y)?"":r}b("next"),(e=new e.Collection(e,function(){return Ge(u[0],f[l-1]+r)}))._ondirectionchange=function(y){b(y)};var d=0;return e._addAlgorithm(function(y,m,g){var w=y.key;if("string"!=typeof w)return!1;var k=a(w);if(t(k,f,d))return!0;for(var E=null,O=d;O<l;++O){var K=function(C,M,D,R,I,N){for(var G=Math.min(C.length,R.length),H=-1,Y=0;Y<G;++Y){var be=M[Y];if(be!==R[Y])return I(C[Y],D[Y])<0?C.substr(0,Y)+D[Y]+D.substr(Y+1):I(C[Y],R[Y])<0?C.substr(0,Y)+R[Y]+D.substr(Y+1):0<=H?C.substr(0,H)+M[H]+D.substr(H+1):null;I(C[Y],be)<0&&(H=Y)}return G<R.length&&"next"===N?C+D.substr(C.length):G<C.length&&"prev"===N?C.substr(0,D.length):H<0?null:C.substr(0,H)+R[H]+D.substr(H+1)}(w,k,u[O],f[O],s,h);null===K&&null===E?d=O+1:(null===E||0<s(E,K))&&(E=K)}return m(null!==E?function(){y.continue(E+v)}:g),!1}),e}function Ge(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function lr(e){return{type:1,lower:e,upper:e}}var fr=(Object.defineProperty(fe.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),fe.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return 0<this._cmp(e,t)||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?ft(this):new this.Collection(this,function(){return Ge(e,t,!n,!r)})}catch{return ge(this,Te)}},fe.prototype.equals=function(e){return null==e?ge(this,Te):new this.Collection(this,function(){return lr(e)})},fe.prototype.above=function(e){return null==e?ge(this,Te):new this.Collection(this,function(){return Ge(e,void 0,!0)})},fe.prototype.aboveOrEqual=function(e){return null==e?ge(this,Te):new this.Collection(this,function(){return Ge(e,void 0,!1)})},fe.prototype.below=function(e){return null==e?ge(this,Te):new this.Collection(this,function(){return Ge(void 0,e,!1,!0)})},fe.prototype.belowOrEqual=function(e){return null==e?ge(this,Te):new this.Collection(this,function(){return Ge(void 0,e)})},fe.prototype.startsWith=function(e){return"string"!=typeof e?ge(this,Jn):this.between(e,e+"\uffff",!0,!0)},fe.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):Qt(this,function(t,n){return 0===t.indexOf(n[0])},[e],"\uffff")},fe.prototype.equalsIgnoreCase=function(e){return Qt(this,function(t,n){return t===n[0]},[e],"")},fe.prototype.anyOfIgnoreCase=function(){var e=Oe.apply(Ee,arguments);return 0===e.length?ft(this):Qt(this,function(t,n){return-1!==n.indexOf(t)},e,"")},fe.prototype.startsWithAnyOfIgnoreCase=function(){var e=Oe.apply(Ee,arguments);return 0===e.length?ft(this):Qt(this,function(t,n){return n.some(function(r){return 0===t.indexOf(r)})},e,"\uffff")},fe.prototype.anyOf=function(){var e=this,t=Oe.apply(Ee,arguments),n=this._cmp;try{t.sort(n)}catch{return ge(this,Te)}if(0===t.length)return ft(this);var r=new this.Collection(this,function(){return Ge(t[0],t[t.length-1])});r._ondirectionchange=function(a){t.sort(n="next"===a?e._ascending:e._descending)};var i=0;return r._addAlgorithm(function(a,s,u){for(var f=a.key;0<n(f,t[i]);)if(++i===t.length)return s(u),!1;return 0===n(f,t[i])||(s(function(){a.continue(t[i])}),!1)}),r},fe.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},fe.prototype.noneOf=function(){var e=Oe.apply(Ee,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ge(this,Te)}var t=e.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},fe.prototype.inAnyRange=function(w,t){var n=this,r=this._cmp,i=this._ascending,a=this._descending,s=this._min,u=this._max;if(0===w.length)return ft(this);if(!w.every(function(k){return void 0!==k[0]&&void 0!==k[1]&&i(k[0],k[1])<=0}))return ge(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",B.InvalidArgument);var v,f=!t||!1!==t.includeLowers,h=t&&!0===t.includeUppers,l=i;function b(k,E){return l(k[0],E[0])}try{(v=w.reduce(function(k,E){for(var O=0,K=k.length;O<K;++O){var C=k[O];if(r(E[0],C[1])<0&&0<r(E[1],C[0])){C[0]=s(C[0],E[0]),C[1]=u(C[1],E[1]);break}}return O===K&&k.push(E),k},[])).sort(b)}catch{return ge(this,Te)}var d=0,y=h?function(k){return 0<i(k,v[d][1])}:function(k){return 0<=i(k,v[d][1])},m=f?function(k){return 0<a(k,v[d][0])}:function(k){return 0<=a(k,v[d][0])},g=y;return(w=new this.Collection(this,function(){return Ge(v[0][0],v[v.length-1][1],!f,!h)}))._ondirectionchange=function(k){l="next"===k?(g=y,i):(g=m,a),v.sort(b)},w._addAlgorithm(function(k,E,O){for(var K,C=k.key;g(C);)if(++d===v.length)return E(O),!1;return!y(K=C)&&!m(K)||(0===n._cmp(C,v[d][1])||0===n._cmp(C,v[d][0])||E(function(){k.continue(l===i?v[d][0]:v[d][1])}),!1)}),w},fe.prototype.startsWithAnyOf=function(){var e=Oe.apply(Ee,arguments);return e.every(function(t){return"string"==typeof t})?0===e.length?ft(this):this.inAnyRange(e.map(function(t){return[t,t+"\uffff"]})):ge(this,"startsWithAnyOf() only works with strings")},fe);function fe(){}function Ae(e){return ne(function(t){return kt(t),e(t.target.error),!1})}function kt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var St="storagemutated",En="x-storagemutated-1",Ve=wt(null,St),Tr=(Me.prototype._lock=function(){return re(!q.global),++this._reculock,1!==this._reculock||q.global||(q.lockOwnerFor=this),this},Me.prototype._unlock=function(){if(re(!q.global),0==--this._reculock)for(q.global||(q.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{Ze(e[1],e[0])}catch{}}return this},Me.prototype._locked=function(){return this._reculock&&q.lockOwnerFor!==this},Me.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(re(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new B.DatabaseClosed(r);case"MissingAPIError":throw new B.MissingAPI(r.message,r);default:throw new B.OpenFailed(r)}if(!this.active)throw new B.TransactionInactive;return re(null===this._completion._state),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ne(function(i){kt(i),t._reject(e.error)}),e.onabort=ne(function(i){kt(i),t.active&&t._reject(new B.Abort(e.error)),t.active=!1,t.on("abort").fire(i)}),e.oncomplete=ne(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Ve.storagemutated.fire(e.mutatedParts)}),this},Me.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return oe(new B.ReadOnly("Transaction is readonly"));if(!this.active)return oe(new B.TransactionInactive);if(this._locked())return new T(function(a,s){r._blockedFuncs.push([function(){r._promise(e,t,n).then(a,s)},q])});if(n)return $e(function(){var a=new T(function(s,u){r._lock();var f=t(s,u,r);f&&f.then&&f.then(s,u)});return a.finally(function(){return r._unlock()}),a._lib=!0,a});var i=new T(function(a,s){var u=t(a,s,r);u&&u.then&&u.then(a,s)});return i._lib=!0,i},Me.prototype._root=function(){return this.parent?this.parent._root():this},Me.prototype.waitFor=function(e){var t,n=this._root(),r=T.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=a)}());var i=n._waitingFor;return new T(function(a,s){r.then(function(u){return n._waitingQueue.push(ne(a.bind(null,u)))},function(u){return n._waitingQueue.push(ne(s.bind(null,u)))}).finally(function(){n._waitingFor===i&&(n._waitingFor=null)})})},Me.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new B.Abort))},Me.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(ue(t,e))return t[e];var n=this.schema[e];if(!n)throw new B.NotFound("Table "+e+" not part of transaction");return(n=new this.db.Table(e,n,this)).core=this.db.core.table(e),t[e]=n},Me);function Me(){}function On(e,t,n,r,i,a,s,u){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+hr(t),type:u}}function hr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function Pn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(i){return[i.name,i]},n.reduce(function(i,a,s){return(s=r(a))&&(i[s[0]]=s[1]),i},{}))};var r}var Et=function(e){try{return e.only([[]]),Et=function(){return[[]]},[[]]}catch{return Et=function(){return"\uffff"},"\uffff"}};function An(e){return null==e?function(){}:"string"==typeof e?1===(t=e).split(".").length?function(n){return n[t]}:function(n){return Se(n,t)}:function(n){return Se(n,e)};var t}function dr(e){return[].slice.call(e)}var Fr=0;function Ot(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function qr(e,t,f){function r(g){if(3===g.type)return null;if(4===g.type)throw new Error("Cannot convert never type to IDBKeyRange");var d=g.lower,y=g.upper,m=g.lowerOpen;return g=g.upperOpen,void 0===d?void 0===y?null:t.upperBound(y,!!g):void 0===y?t.lowerBound(d,!!m):t.bound(d,y,!!m,!!g)}var a,s,u,h=(s=f,u=dr((a=e).objectStoreNames),v={schema:{name:a.name,tables:u.map(function(b){return s.objectStore(b)}).map(function(b){var d=b.keyPath,g=b.autoIncrement,y=W(d),m={};return g={name:b.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==d,compound:y,keyPath:d,autoIncrement:g,unique:!0,extractKey:An(d)},indexes:dr(b.indexNames).map(function(w){return b.index(w)}).map(function(O){var E=O.unique,K=O.multiEntry;return K={name:O.name,compound:W(O=O.keyPath),keyPath:O,unique:E,multiEntry:K,extractKey:An(O)},m[Ot(O)]=K}),getIndexByKeyPath:function(w){return m[Ot(w)]}},m[":id"]=g.primaryKey,null!=d&&(m[Ot(d)]=g.primaryKey),g})},hasGetAll:0<u.length&&"getAll"in s.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}).hasGetAll,v=(f=v.schema).tables.map(function i(b){var d,y=b.name;return{name:y,schema:b,mutate:function(m){var g=m.trans,w=m.type,k=m.keys,E=m.values,O=m.range;return new Promise(function(K,C){K=ne(K);var M=g.objectStore(y),D=null==M.keyPath,R="put"===w||"add"===w;if(!R&&"delete"!==w&&"deleteRange"!==w)throw new Error("Invalid operation type: "+w);var I,N=(k||E||{length:1}).length;if(k&&E&&k.length!==E.length)throw new Error("Given keys array must have same length as given values array.");if(0===N)return K({numFailures:0,failures:{},results:[],lastResult:void 0});function G(ve){++be,kt(ve)}var H=[],Y=[],be=0;if("deleteRange"===w){if(4===O.type)return K({numFailures:be,failures:Y,results:[],lastResult:void 0});H.push(I=3===O.type?M.clear():M.delete(r(O)))}else{var z=(D=R?D?[E,k]:[E,null]:[k,null])[0],ye=D[1];if(R)for(var me=0;me<N;++me)H.push(I=ye&&void 0!==ye[me]?M[w](z[me],ye[me]):M[w](z[me])),I.onerror=G;else for(me=0;me<N;++me)H.push(I=M[w](z[me])),I.onerror=G}function cn(ve){ve=ve.target.result,H.forEach(function(rt,Vn){return null!=rt.error&&(Y[Vn]=rt.error)}),K({numFailures:be,failures:Y,results:"delete"===w?k:H.map(function(rt){return rt.result}),lastResult:ve})}I.onerror=function(ve){G(ve),cn(ve)},I.onsuccess=cn})},getMany:function(m){var g=m.trans,w=m.keys;return new Promise(function(k,E){k=ne(k);for(var O,K=g.objectStore(y),C=w.length,M=new Array(C),D=0,R=0,I=function(H){M[(H=H.target)._pos]=H.result,++R===D&&k(M)},N=Ae(E),G=0;G<C;++G)null!=w[G]&&((O=K.get(w[G]))._pos=G,O.onsuccess=I,O.onerror=N,++D);0===D&&k(M)})},get:function(m){var g=m.trans,w=m.key;return new Promise(function(k,E){k=ne(k);var O=g.objectStore(y).get(w);O.onsuccess=function(K){return k(K.target.result)},O.onerror=Ae(E)})},query:(d=h,function(m){return new Promise(function(g,w){g=ne(g);var k,E,O,K=m.values,C=m.limit,M=C===1/0?void 0:C,R=(I=m.query).index,I=I.range,D=(D=m.trans).objectStore(y);if(R=R.isPrimaryKey?D:D.index(R.name),I=r(I),0===C)return g({result:[]});d?((M=K?R.getAll(I,M):R.getAllKeys(I,M)).onsuccess=function(N){return g({result:N.target.result})},M.onerror=Ae(w)):(k=0,E=!K&&"openKeyCursor"in R?R.openKeyCursor(I):R.openCursor(I),O=[],E.onsuccess=function(N){var G=E.result;return G?(O.push(K?G.value:G.primaryKey),++k===C?g({result:O}):void G.continue()):g({result:O})},E.onerror=Ae(w))})}),openCursor:function(m){var g=m.trans,w=m.values,k=m.query,E=m.reverse,O=m.unique;return new Promise(function(K,C){K=ne(K);var R=k.index,M=k.range,D=g.objectStore(y),I=(D=R.isPrimaryKey?D:D.index(R.name),R=E?O?"prevunique":"prev":O?"nextunique":"next",!w&&"openKeyCursor"in D?D.openKeyCursor(r(M),R):D.openCursor(r(M),R));I.onerror=Ae(C),I.onsuccess=ne(function(N){var G,H,Y,be,z=I.result;z?(z.___id=++Fr,z.done=!1,G=z.continue.bind(z),H=(H=z.continuePrimaryKey)&&H.bind(z),Y=z.advance.bind(z),be=function(){throw new Error("Cursor not stopped")},z.trans=g,z.stop=z.continue=z.continuePrimaryKey=z.advance=function(){throw new Error("Cursor not started")},z.fail=ne(C),z.next=function(){var ye=this,me=1;return this.start(function(){return me--?ye.continue():ye.stop()}).then(function(){return ye})},z.start=function(ye){function me(){if(I.result)try{ye()}catch(ve){z.fail(ve)}else z.done=!0,z.start=function(){throw new Error("Cursor behind last entry")},z.stop()}var cn=new Promise(function(ve,rt){ve=ne(ve),I.onerror=Ae(rt),z.fail=rt,z.stop=function(Vn){z.stop=z.continue=z.continuePrimaryKey=z.advance=be,ve(Vn)}});return I.onsuccess=ne(function(ve){I.onsuccess=me,me()}),z.continue=G,z.continuePrimaryKey=H,z.advance=Y,me(),cn},K(z)):K(null)},C)})},count:function(m){var g=m.query,w=m.trans,k=g.index,E=g.range;return new Promise(function(O,K){var C=w.objectStore(y),M=k.isPrimaryKey?C:C.index(k.name);(M=(C=r(E))?M.count(C):M.count()).onsuccess=ne(function(D){return O(D.target.result)}),M.onerror=Ae(K)})}}}),l={};return v.forEach(function(b){return l[b.name]=b}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(b){if(!l[b])throw new Error("Table '".concat(b,"' not found"));return l[b]},MIN_KEY:-1/0,MAX_KEY:Et(t),schema:f}}function Xt(e,r){r=function Nr(e,t,n,r){return{dbcore:(r=qr(t,n.IDBKeyRange,r),e.dbcore.reduce(function(a,s){return s=s.create,L(L({},a),s(a))},r))}}(e._middlewares,r.db,e._deps,r),e.core=r.dbcore,e.tables.forEach(function(i){var a=i.name;e.core.schema.tables.some(function(s){return s.name===a})&&(i.core=e.core.table(a),e[a]instanceof e.Table&&(e[a].core=i.core))})}function Zt(e,t,n,r){n.forEach(function(i){var a=r[i];t.forEach(function(s){var u=function f(h,v){return fn(h,v)||(h=Ke(h))&&f(h,v)}(s,i);(!u||"value"in u&&void 0===u.value)&&(s===e.Transaction.prototype||s instanceof e.Transaction?Pe(s,i,{get:function(){return this.table(i)},set:function(f){pt(this,i,{value:f,writable:!0,configurable:!0,enumerable:!0})}}):s[i]=new e.Table(i,a))})})}function Mn(e,t){t.forEach(function(n){for(var r in n)n[r]instanceof e.Table&&delete n[r]})}function Br(e,t){return e._cfg.version-t._cfg.version}function Kn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],a=t[n];if(i){var s={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto)s.recreate=!0,r.change.push(s);else{var u=i.idxByName,f=a.idxByName,h=void 0;for(h in u)f[h]||s.del.push(h);for(h in f){var v=u[h],l=f[h];v?v.src!==l.src&&s.change.push(l):s.add.push(l)}(0<s.del.length||0<s.add.length||0<s.change.length)&&r.change.push(s)}}else r.add.push([n,a])}return r}function Dn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return Jt(i,a)}),i}function pr(e,t){F(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(we&&console.debug("Dexie: Creating missing table",n),Dn(t,n,e[n].primKey,e[n].indexes))})}function Jt(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function en(e,t,n){var r={};return Be(t.objectStoreNames,0).forEach(function(i){for(var a=n.objectStore(i),s=On(hr(h=a.keyPath),h||"",!0,!1,!!a.autoIncrement,h&&"string"!=typeof h,!0),u=[],f=0;f<a.indexNames.length;++f){var h=(v=a.index(a.indexNames[f])).keyPath,v=On(v.name,h,!!v.unique,!!v.multiEntry,!1,h&&"string"!=typeof h,!1);u.push(v)}r[i]=Pn(i,s,u)}),r}function tn(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],s=n.objectStore(a);e._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var f=s.indexNames[u],h=s.index(f).keyPath,v="string"==typeof h?h:"["+Be(h).join("+")+"]";!t[a]||(h=t[a].idxByName[v])&&(h.name=f,delete t[a].idxByName[v],t[a].idxByName[f]=h)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&A.WorkerGlobalScope&&A instanceof A.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function yr(e){return e.split(",").map(function(t,n){var r=null===(i=(a=t.split(":"))[1])||void 0===i?void 0:i.trim(),i=(t=a[0].trim()).replace(/([&*]|\+\+)/g,""),a=/^\[/.test(i)?i.match(/^\[(.*)\]$/)[1].split("+"):i;return On(i,a||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),W(a),0===n,r)})}var Ur=(ht.prototype._createTableSchema=Pn,ht.prototype._parseIndexSyntax=yr,ht.prototype._parseStoresSpec=function(e,t){var n=this;F(e).forEach(function(r){if(null!==e[r]){var i=n._parseIndexSyntax(e[r]),a=i.shift();if(!a)throw new B.Schema("Invalid schema for table "+r+": "+e[r]);if(a.unique=!0,a.multi)throw new B.Schema("Primary key cannot be multiEntry*");i.forEach(function(s){if(s.auto)throw new B.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new B.Schema("Index must have a name and cannot be an empty string")}),i=n._createTableSchema(r,a,i),t[r]=i}})},ht.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?ie(this._cfg.storesSource,n):n;var r={},i={};return(n=t._versions).forEach(function(a){ie(r,a._cfg.storesSource),i=a._cfg.dbschema={},a._parseStoresSpec(r,i)}),t._dbSchema=i,Mn(t,[t._allTables,t,t.Transaction.prototype]),Zt(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],F(i),i),t._storeNames=F(i),this},ht.prototype.upgrade=function(e){return this._cfg.contentUpgrade=at(this._cfg.contentUpgrade||Z,e),this},ht);function ht(){}function In(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Fe(Gt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Cn(e){return e&&"function"==typeof e.databases}function Rn(e){return $e(function(){return q.letThrough=!0,e()})}function jn(e){return!("from"in e)}var pe=function(e,t){if(!this){var n=new pe;return e&&"d"in e&&ie(n,e),n}ie(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Pt(e,t,n){var r=Q(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(jn(e))return ie(e,{from:t,to:n,d:1});var i=e.l;if(r=e.r,Q(n,e.from)<0)return i?Pt(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},vr(e);if(0<Q(t,e.to))return r?Pt(r,t,n):e.r={from:t,to:n,d:1,l:null,r:null},vr(e);Q(t,e.from)<0&&(e.from=t,e.l=null,e.d=r?r.d+1:1),0<Q(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,i&&!e.l&&At(e,i),r&&n&&At(e,r)}}function At(e,t){jn(t)||function n(r,f){var a=f.from,s=f.to,u=f.l;f=f.r,Pt(r,a,s),u&&n(r,u),f&&n(r,f)}(e,t)}function mr(e,t){var n=nn(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=nn(e),s=a.next(i.from),u=s.value;!r.done&&!s.done;){if(Q(u.from,i.to)<=0&&0<=Q(u.to,i.from))return!0;Q(i.from,u.from)<0?i=(r=n.next(u.from)).value:u=(s=a.next(i.from)).value}return!1}function nn(e){var t=jn(e)?null:{s:0,n:e};return{next:function(n){for(var r=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&Q(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||Q(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function vr(e){var t,n,r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),i=1<r?"r":r<-1?"l":"";i&&(t="r"==i?"l":"r",n=L({},e),e.from=(r=e[i]).from,e.to=r.to,e[i]=r[i],n[i]=r[t],(e[t]=n).d=gr(n)),e.d=gr(e)}function gr(n){var t=n.r;return n=n.l,(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function rn(e,t){return F(t).forEach(function(n){e[n]?At(e[n],t[n]):e[n]=function r(i){var a,s,u={};for(a in i)ue(i,a)&&(u[a]=!(s=i[a])||"object"!=typeof s||mt.has(s.constructor)?s:r(s));return u}(t[n])}),e}function Tn(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&mr(t[n],e[n])})}ke(pe.prototype,((xe={add:function(e){return At(this,e),this},addKey:function(e){return Pt(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return Pt(t,n,n)}),this},hasKey:function(e){var t=nn(this).next(e).value;return t&&Q(t.from,e)<=0&&0<=Q(t.to,e)}})[vt]=function(){return nn(this)},xe));var tt={},Fn={},qn=!1;function an(e){rn(Fn,e),qn||(qn=!0,setTimeout(function(){qn=!1,Nn(Fn,!(Fn={}))},0))}function Nn(e,t){void 0===t&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(tt);r<i.length;r++)br(s=i[r],e,n,t);else for(var a in e){var s,u=/^idb\:\/\/(.*)\/(.*)\//.exec(a);u&&(a=u[1],u=u[2],(s=tt["idb://".concat(a,"/").concat(u)])&&br(s,e,n,t))}n.forEach(function(f){return f()})}function br(e,t,n,r){for(var i=[],a=0,s=Object.entries(e.queries.query);a<s.length;a++){for(var u=s[a],f=u[0],h=[],v=0,l=u[1];v<l.length;v++){var b=l[v];Tn(t,b.obsSet)?b.subscribers.forEach(function(g){return n.add(g)}):r&&h.push(b)}r&&i.push([f,h])}if(r)for(var d=0,y=i;d<y.length;d++){var m=y[d];e.queries.query[f=m[0]]=h=m[1]}}function zr(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?oe(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),a=!1;function s(){if(t.openCanceller!==r)throw new B.DatabaseClosed("db.open() was cancelled")}var f,h=t.dbReadyResolve,v=null,l=!1;return T.race([r,(typeof navigator>"u"?T.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(b){function d(){return indexedDB.databases().finally(b)}f=setInterval(d,100),d()}).finally(function(){return clearInterval(f)}):Promise.resolve()).then(function u(){return new T(function(b,d){if(s(),!n)throw new B.MissingAPI;var y=e.name,m=t.autoSchema||!i?n.open(y):n.open(y,i);if(!m)throw new B.MissingAPI;m.onerror=Ae(d),m.onblocked=ne(e._fireOnBlocked),m.onupgradeneeded=ne(function(g){var w;v=m.transaction,t.autoSchema&&!e._options.allowEmptyDB?(m.onerror=kt,v.abort(),m.result.close(),(w=n.deleteDatabase(y)).onsuccess=w.onerror=ne(function(){d(new B.NoSuchDatabase("Database ".concat(y," doesnt exist")))})):(v.onerror=Ae(d),g=g.oldVersion>Math.pow(2,62)?0:g.oldVersion,l=g<1,e.idbdb=m.result,a&&function $r(e,t){pr(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=en(0,e.idbdb,t);tn(e,e._dbSchema,t);for(var r=0,i=Kn(n,e._dbSchema).change;r<i.length;r++){var a=function(s){if(s.change.length||s.recreate)return console.warn("Unable to patch indexes of table ".concat(s.name," because it has changes on the type of index or primary key.")),{value:void 0};var u=t.objectStore(s.name);s.add.forEach(function(f){we&&console.debug("Dexie upgrade patch: Creating missing index ".concat(s.name,".").concat(f.src)),Jt(u,f)})}(i[r]);if("object"==typeof a)return a.value}}(e,v),function Lr(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=Pn("$meta",yr("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,i);a.create(n),a._completion.catch(r);var s=a._reject.bind(a),u=q.transless||q;$e(function(){return q.trans=a,q.transless=u,0!==t?(Xt(e,n),h=t,((f=a).storeNames.includes("$meta")?f.table("$meta").get("version").then(function(v){return v??h}):T.resolve(h)).then(function(v){return b=v,d=a,m=[],v=(l=e)._versions,g=l._dbSchema=en(0,l.idbdb,y=n),0!==(v=v.filter(function(w){return w._cfg.version>=b})).length?(v.forEach(function(w){m.push(function(){var k=g,E=w._cfg.dbschema;tn(l,k,y),tn(l,E,y),g=l._dbSchema=E;var O=Kn(k,E);O.add.forEach(function(R){Dn(y,R[0],R[1].primKey,R[1].indexes)}),O.change.forEach(function(R){if(R.recreate)throw new B.Upgrade("Not yet support for changing primary key");var I=y.objectStore(R.name);R.add.forEach(function(N){return Jt(I,N)}),R.change.forEach(function(N){I.deleteIndex(N.name),Jt(I,N)}),R.del.forEach(function(N){return I.deleteIndex(N)})});var K=w._cfg.contentUpgrade;if(K&&w._cfg.version>b){Xt(l,y),d._memoizedTables={};var C=Kt(E);O.del.forEach(function(R){C[R]=k[R]}),Mn(l,[l.Transaction.prototype]),Zt(l,[l.Transaction.prototype],F(C),C),d.schema=C;var M,D=gt(K);return D&&ut(),O=T.follow(function(){var R;(M=K(d))&&D&&(R=Ue.bind(null,null),M.then(R,R))}),M&&"function"==typeof M.then?T.resolve(M):O.then(function(){return M})}}),m.push(function(k){var E,O;E=w._cfg.dbschema,[].slice.call((O=k).db.objectStoreNames).forEach(function(C){return null==E[C]&&O.db.deleteObjectStore(C)}),Mn(l,[l.Transaction.prototype]),Zt(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),d.schema=l._dbSchema}),m.push(function(k){l.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(l.idbdb.version/10)===w._cfg.version?(l.idbdb.deleteObjectStore("$meta"),delete l._dbSchema.$meta,l._storeNames=l._storeNames.filter(function(E){return"$meta"!==E})):k.objectStore("$meta").put(w._cfg.version,"version"))})}),function w(){return m.length?T.resolve(m.shift()(d.idbtrans)).then(w):T.resolve()}().then(function(){pr(g,y)})):T.resolve();var l,b,d,y,m,g}).catch(s)):(F(i).forEach(function(v){Dn(n,v,i[v].primKey,i[v].indexes)}),Xt(e,n),void T.follow(function(){return e.on.populate.fire(a)}).catch(s));var f,h})}(e,g/10,v,d))},d),m.onsuccess=ne(function(){v=null;var g,w,k,E,O,K=e.idbdb=m.result,C=Be(K.objectStoreNames);if(0<C.length)try{var M=K.transaction(1===(E=C).length?E[0]:E,"readonly");if(t.autoSchema)k=M,(g=e).verno=(w=K).version/10,k=g._dbSchema=en(0,w,k),g._storeNames=Be(w.objectStoreNames,0),Zt(g,[g._allTables],F(k),k);else if(tn(e,e._dbSchema,M),((O=Kn(en(0,(O=e).idbdb,M),O._dbSchema)).add.length||O.change.some(function(D){return D.add.length||D.change.length}))&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),K.close(),i=K.version+1,a=!0,b(u());Xt(e,M)}catch{}ct.push(e),K.onversionchange=ne(function(D){t.vcFired=!0,e.on("versionchange").fire(D)}),K.onclose=ne(function(){e.close({disableAutoOpen:!1})}),l&&(M=y,K=(O=e._deps).indexedDB,O=O.IDBKeyRange,Cn(K)||M===Gt||In(K,O).put({name:M}).catch(Z)),b()},d)}).catch(function(b){switch(b?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),u();break;case"VersionError":if(0<i)return i=0,u()}return T.reject(b)})})]).then(function(){return s(),t.onReadyBeingFired=[],T.resolve(Rn(function(){return e.on.ready.fire(e.vip)})).then(function b(){if(0<t.onReadyBeingFired.length){var d=t.onReadyBeingFired.reduce(at,Z);return t.onReadyBeingFired=[],T.resolve(Rn(function(){return d(e.vip)})).then(b)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(b){t.dbOpenError=b;try{v&&v.abort()}catch{}return r===t.openCanceller&&e._close(),oe(b)}).finally(function(){t.openComplete=!0,h()}).then(function(){var b;return l&&(b={},e.tables.forEach(function(d){d.schema.indexes.forEach(function(y){y.name&&(b["idb://".concat(e.name,"/").concat(d.name,"/").concat(y.name)]=new pe(-1/0,[[[]]]))}),b["idb://".concat(e.name,"/").concat(d.name,"/")]=b["idb://".concat(e.name,"/").concat(d.name,"/:dels")]=new pe(-1/0,[[[]]])}),Ve(St).fire(b),Nn(b,!0)),e})}function Bn(e){function t(a){return e.next(a)}var n=i(t),r=i(function(a){return e.throw(a)});function i(a){return function(f){var u=a(f);return f=u.value,u.done?f:f&&"function"==typeof f.then?f.then(n,r):W(f)?Promise.all(f).then(n,r):n(f)}}return i(t)()}function on(e,t,n){for(var r=W(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var Gr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return L(L({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function s(l,b,d){var y=Ot(l),m=i[y]=i[y]||[],g=null==l?0:"string"==typeof l?1:l.length,w=0<b;return w=L(L({},d),{name:w?"".concat(y,"(virtual-from:").concat(d.name,")"):d.name,lowLevelIndex:d,isVirtual:w,keyTail:b,keyLength:g,extractKey:An(l),unique:!w&&d.unique}),m.push(w),w.isPrimaryKey||a.push(w),1<g&&s(2===g?l[0]:l.slice(0,g-1),b+1,d),m.sort(function(k,E){return k.keyTail-E.keyTail}),w}t=s(r.primaryKey.keyPath,0,r.primaryKey),i[":id"]=[t];for(var u=0,f=r.indexes;u<f.length;u++){var h=f[u];s(h.keyPath,0,h)}function v(l){var b,d=l.query.index;return d.isVirtual?L(L({},l),{query:{index:d.lowLevelIndex,range:(b=l.query.range,d=d.keyTail,{type:1===b.type?2:b.type,lower:on(b.lower,b.lowerOpen?e.MAX_KEY:e.MIN_KEY,d),lowerOpen:!0,upper:on(b.upper,b.upperOpen?e.MIN_KEY:e.MAX_KEY,d),upperOpen:!0})}}):l}return L(L({},n),{schema:L(L({},r),{primaryKey:t,indexes:a,getIndexByKeyPath:function(l){return(l=i[Ot(l)])&&l[0]}}),count:function(l){return n.count(v(l))},query:function(l){return n.query(v(l))},openCursor:function(l){var b=l.query.index,d=b.keyTail,m=b.keyLength;return b.isVirtual?n.openCursor(v(l)).then(function(w){return w&&function g(w){return Object.create(w,{continue:{value:function(k){null!=k?w.continue(on(k,l.reverse?e.MAX_KEY:e.MIN_KEY,d)):l.unique?w.continue(w.key.slice(0,m).concat(l.reverse?e.MIN_KEY:e.MAX_KEY,d)):w.continue()}},continuePrimaryKey:{value:function(k,E){w.continuePrimaryKey(on(k,e.MAX_KEY,d),E)}},primaryKey:{get:function(){return w.primaryKey}},key:{get:function(){var k=w.key;return 1===m?k[0]:k.slice(0,m)}},value:{get:function(){return w.value}}})}(w)}):n.openCursor(l)}})}})}};function Ln(e,t,n,r){return n=n||{},r=r||"",F(e).forEach(function(i){var a,s,u;ue(t,i)?(s=t[i],"object"==typeof(a=e[i])&&"object"==typeof s&&a&&s?(u=Dt(a))!==Dt(s)?n[r+i]=t[i]:"Object"===u?Ln(a,s,n,r+i+"."):a!==s&&(n[r+i]=t[i]):a!==s&&(n[r+i]=t[i])):n[r+i]=void 0}),F(t).forEach(function(i){ue(e,i)||(n[r+i]=t[i])}),n}function $n(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}var Vr={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return L(L({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return L(L({},n),{mutate:function(i){var a=q.trans,s=a.table(t).hook,u=s.deleting,f=s.creating,h=s.updating;switch(i.type){case"add":if(f.fire===Z)break;return a._promise("readwrite",function(){return v(i)},!0);case"put":if(f.fire===Z&&h.fire===Z)break;return a._promise("readwrite",function(){return v(i)},!0);case"delete":if(u.fire===Z)break;return a._promise("readwrite",function(){return v(i)},!0);case"deleteRange":if(u.fire===Z)break;return a._promise("readwrite",function(){return function l(b,d,y){return n.query({trans:b,values:!1,query:{index:r,range:d},limit:y}).then(function(m){var g=m.result;return v({type:"delete",keys:g,trans:b}).then(function(w){return 0<w.numFailures?Promise.reject(w.failures[0]):g.length<y?{failures:[],numFailures:0,lastResult:void 0}:l(b,L(L({},d),{lower:g[g.length-1],lowerOpen:!0}),y)})})}(i.trans,i.range,1e4)},!0)}return n.mutate(i);function v(l){var b,d,y,m=q.trans,g=l.keys||$n(r,l);if(!g)throw new Error("Keys missing");return"delete"!==(l="add"===l.type||"put"===l.type?L(L({},l),{keys:g}):L({},l)).type&&(l.values=U([],l.values,!0)),l.keys&&(l.keys=U([],l.keys,!0)),b=n,y=g,("add"===(d=l).type?Promise.resolve([]):b.getMany({trans:d.trans,keys:y,cache:"immutable"})).then(function(w){var k=g.map(function(E,O){var K,C,M,D=w[O],R={onerror:null,onsuccess:null};return"delete"===l.type?u.fire.call(R,E,D,m):"add"===l.type||void 0===D?(K=f.fire.call(R,E,l.values[O],m),null==E&&null!=K&&(l.keys[O]=E=K,r.outbound||he(l.values[O],r.keyPath,E))):(K=Ln(D,l.values[O]),(C=h.fire.call(R,K,E,D,m))&&(M=l.values[O],Object.keys(C).forEach(function(I){ue(M,I)?M[I]=C[I]:he(M,I,C[I])}))),R});return n.mutate(l).then(function(E){for(var O=E.failures,K=E.results,C=E.numFailures,M=(E=E.lastResult,0);M<g.length;++M){var D=(K||g)[M],R=k[M];null==D?R.onerror&&R.onerror(O[M]):R.onsuccess&&R.onsuccess("put"===l.type&&w[M]?l.values[M]:D)}return{failures:O,results:K,numFailures:C,lastResult:E}}).catch(function(E){return k.forEach(function(O){return O.onerror&&O.onerror(E)}),Promise.reject(E)})})}}})}})}};function _r(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)0===Q(t.keys[i],e[a])&&(r.push(n?De(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var Hr={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return L(L({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=_r(r.keys,r.trans._cache,"clone"===r.cache);return i?T.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:"clone"===r.cache?De(a):a},a})},mutate:function(r){return"add"!==r.type&&(r.trans._cache=null),n.mutate(r)}})}}}};function wr(e,t){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!t.schema.primaryKey.outbound}function xr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Yr={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new pe(e.MIN_KEY,e.MAX_KEY);return L(L({},e),{transaction:function(r,i,a){if(q.subscr&&"readonly"!==i)throw new B.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(q.querier));return e.transaction(r,i,a)},table:function(r){var i=e.table(r),a=i.schema,s=a.primaryKey,l=a.indexes,u=s.extractKey,f=s.outbound,h=s.autoIncrement&&l.filter(function(d){return d.compound&&d.keyPath.includes(s.keyPath)}),v=L(L({},i),{mutate:function(d){function y(I){return I="idb://".concat(t,"/").concat(r,"/").concat(I),E[I]||(E[I]=new pe)}var m,g,w,k=d.trans,E=d.mutatedParts||(d.mutatedParts={}),O=y(""),K=y(":dels"),C=d.type,M=(R="deleteRange"===d.type?[d.range]:"delete"===d.type?[d.keys]:d.values.length<50?[$n(s,d).filter(function(I){return I}),d.values]:[])[0],D=R[1],R=d.trans._cache;return W(M)?(O.addKeys(M),(R="delete"===C||M.length===D.length?_r(M,R):null)||K.addKeys(M),(R||D)&&(m=y,g=R,w=D,a.indexes.forEach(function(I){var N=m(I.name||"");function G(Y){return null!=Y?I.extractKey(Y):null}function H(Y){return I.multiEntry&&W(Y)?Y.forEach(function(be){return N.addKey(be)}):N.addKey(Y)}(g||w).forEach(function(Y,ye){var z=g&&G(g[ye]);0!==Q(z,ye=w&&G(w[ye]))&&(null!=z&&H(z),null!=ye&&H(ye))})}))):M?(D={from:null!==(D=M.lower)&&void 0!==D?D:e.MIN_KEY,to:null!==(D=M.upper)&&void 0!==D?D:e.MAX_KEY},K.add(D),O.add(D)):(O.add(n),K.add(n),a.indexes.forEach(function(I){return y(I.name).add(n)})),i.mutate(d).then(function(I){return!M||"add"!==d.type&&"put"!==d.type||(O.addKeys(I.results),h&&h.forEach(function(N){for(var G=d.values.map(function(z){return N.extractKey(z)}),H=N.keyPath.findIndex(function(z){return z===s.keyPath}),Y=0,be=I.results.length;Y<be;++Y)G[Y][H]=I.results[Y];y(N.name).addKeys(G)})),k.mutatedParts=rn(k.mutatedParts||{},E),I})}}),b={get:function(d){return[s,new pe(d.key)]},getMany:function(d){return[s,(new pe).addKeys(d.keys)]},count:l=function(y){var m;return[y=(m=y.query).index,new pe(null!==(y=(m=m.range).lower)&&void 0!==y?y:e.MIN_KEY,null!==(m=m.upper)&&void 0!==m?m:e.MAX_KEY)]},query:l,openCursor:l};return F(b).forEach(function(d){v[d]=function(y){var g=!!(m=q.subscr),w=wr(q,i)&&xr(d,y)?y.obsSet={}:m;if(g){var k=function(D){return D="idb://".concat(t,"/").concat(r,"/").concat(D),w[D]||(w[D]=new pe)},E=k(""),O=k(":dels"),m=(g=(m=b[d](y))[0],m[1]);if(("query"===d&&g.isPrimaryKey&&!y.values?O:k(g.name||"")).add(m),!g.isPrimaryKey){if("count"!==d){var K="query"===d&&f&&y.values&&i.query(L(L({},y),{values:!1}));return i[d].apply(this,arguments).then(function(D){if("query"===d){if(f&&y.values)return K.then(function(G){return E.addKeys(G=G.result),D});var R=y.values?D.result.map(u):D.result;(y.values?E:O).addKeys(R)}else if("openCursor"===d){var I=D,N=y.values;return I&&Object.create(I,{key:{get:function(){return O.addKey(I.primaryKey),I.key}},primaryKey:{get:function(){var G=I.primaryKey;return O.addKey(G),G}},value:{get:function(){return N&&E.addKey(I.primaryKey),I.value}}})}return D})}O.add(n)}}return i[d].apply(this,arguments)}}),v}})}};function kr(e,t,n){return 0===n.numFailures?t:"deleteRange"===t.type||n.numFailures===(t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1)?null:(t=L({},t),W(t.keys)&&(t.keys=t.keys.filter(function(i,a){return!(a in n.failures)})),"values"in t&&W(t.values)&&(t.values=t.values.filter(function(i,a){return!(a in n.failures)})),t)}function Un(e,t){return n=e,(void 0===(r=t).lower||(r.lowerOpen?0<Q(n,r.lower):0<=Q(n,r.lower)))&&(void 0===t.upper||(t.upperOpen?Q(e,t.upper)<0:Q(e,t.upper)<=0));var n,r}function Sr(e,t,b,r,i,a){if(!b||0===b.length)return e;var s=t.query.index,u=s.multiEntry,f=t.query.range,h=r.schema.primaryKey.extractKey,v=s.extractKey,l=(s.lowLevelIndex||s).extractKey;return(b=b.reduce(function(d,y){var m=d,g=[];if("add"===y.type||"put"===y.type)for(var w=new pe,k=y.values.length-1;0<=k;--k){var E,O=y.values[k],K=h(O);w.hasKey(K)||(E=v(O),(u&&W(E)?E.some(function(I){return Un(I,f)}):Un(E,f))&&(w.addKey(K),g.push(O)))}switch(y.type){case"add":var C=(new pe).addKeys(t.values?d.map(function(N){return h(N)}):d);m=d.concat(t.values?g.filter(function(N){return N=h(N),!C.hasKey(N)&&(C.addKey(N),!0)}):g.map(function(N){return h(N)}).filter(function(N){return!C.hasKey(N)&&(C.addKey(N),!0)}));break;case"put":var M=(new pe).addKeys(y.values.map(function(N){return h(N)}));m=d.filter(function(N){return!M.hasKey(t.values?h(N):N)}).concat(t.values?g:g.map(function(N){return h(N)}));break;case"delete":var D=(new pe).addKeys(y.keys);m=d.filter(function(N){return!D.hasKey(t.values?h(N):N)});break;case"deleteRange":var R=y.range;m=d.filter(function(N){return!Un(h(N),R)})}return m},e))===e?e:(b.sort(function(d,y){return Q(l(d),l(y))||Q(h(d),h(y))}),t.limit&&t.limit<1/0&&(b.length>t.limit?b.length=t.limit:e.length===t.limit&&b.length<t.limit&&(i.dirty=!0)),a?Object.freeze(b):b)}function Er(e,t){return 0===Q(e.lower,t.lower)&&0===Q(e.upper,t.upper)&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}var Xr={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return L(L({},e),{transaction:function(n,r,i){var a,s,u=e.transaction(n,r,i);return"readwrite"===r&&(s=(a=new AbortController).signal,u.addEventListener("abort",(i=function(f){return function(){if(a.abort(),"readwrite"===r){for(var h=new Set,v=0,l=n;v<l.length;v++){var b=l[v],d=tt["idb://".concat(t,"/").concat(b)];if(d){var y=e.table(b),m=d.optimisticOps.filter(function(N){return N.trans===u});if(u._explicit&&f&&u.mutatedParts)for(var g=0,w=Object.values(d.queries.query);g<w.length;g++)for(var k=0,E=(C=w[g]).slice();k<E.length;k++)Tn((M=E[k]).obsSet,u.mutatedParts)&&(Ie(C,M),M.subscribers.forEach(function(N){return h.add(N)}));else if(0<m.length){d.optimisticOps=d.optimisticOps.filter(function(N){return N.trans!==u});for(var O=0,K=Object.values(d.queries.query);O<K.length;O++)for(var C,M,D,R=0,I=(C=K[O]).slice();R<I.length;R++)null!=(M=I[R]).res&&u.mutatedParts&&(f&&!M.dirty?(D=Object.isFrozen(M.res),D=Sr(M.res,M.req,m,y,M,D),M.dirty?(Ie(C,M),M.subscribers.forEach(function(N){return h.add(N)})):D!==M.res&&(M.res=D,M.promise=T.resolve({result:D}))):(M.dirty&&Ie(C,M),M.subscribers.forEach(function(N){return h.add(N)})))}}}h.forEach(function(N){return N()})}}})(!1),{signal:s}),u.addEventListener("error",i(!1),{signal:s}),u.addEventListener("complete",i(!0),{signal:s})),u},table:function(n){var r=e.table(n),i=r.schema.primaryKey;return L(L({},r),{mutate:function(a){var s=q.trans;if(i.outbound||"disabled"===s.db._options.cache||s.explicit||"readwrite"!==s.idbtrans.mode)return r.mutate(a);var u=tt["idb://".concat(t,"/").concat(n)];return u?(s=r.mutate(a),"add"!==a.type&&"put"!==a.type||!(50<=a.values.length||$n(i,a).some(function(f){return null==f}))?(u.optimisticOps.push(a),a.mutatedParts&&an(a.mutatedParts),s.then(function(f){0<f.numFailures&&(Ie(u.optimisticOps,a),(f=kr(0,a,f))&&u.optimisticOps.push(f),a.mutatedParts&&an(a.mutatedParts))}),s.catch(function(){Ie(u.optimisticOps,a),a.mutatedParts&&an(a.mutatedParts)})):s.then(function(f){var h=kr(0,L(L({},a),{values:a.values.map(function(v,l){var b;return f.failures[l]||he(v=null!==(b=i.keyPath)&&void 0!==b&&b.includes(".")?De(v):L({},v),i.keyPath,f.results[l]),v})}),f);u.optimisticOps.push(h),queueMicrotask(function(){return a.mutatedParts&&an(a.mutatedParts)})}),s):r.mutate(a)},query:function(a){if(!wr(q,r)||!xr("query",a))return r.query(a);var s="immutable"===(null===(h=q.trans)||void 0===h?void 0:h.db._options.cache),u=(l=q).requery,f=l.signal,h=function(y,m,g,w){var k=tt["idb://".concat(y,"/").concat(m)];if(!k)return[];if(!(m=k.queries[g]))return[null,!1,k,null];var E=m[(w.query?w.query.index.name:null)||""];if(!E)return[null,!1,k,null];switch(g){case"query":var O=E.find(function(K){return K.req.limit===w.limit&&K.req.values===w.values&&Er(K.req.query.range,w.query.range)});return O?[O,!0,k,E]:[E.find(function(K){return("limit"in K.req?K.req.limit:1/0)>=w.limit&&(!w.values||K.req.values)&&function Wr(e,t){return function(n,r,i,a){if(void 0===n)return void 0!==r?-1:0;if(void 0===r)return 1;if(0===(r=Q(n,r))){if(i&&a)return 0;if(i)return 1;if(a)return-1}return r}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(n,r,i,a){if(void 0===n)return void 0!==r?1:0;if(void 0===r)return-1;if(0===(r=Q(n,r))){if(i&&a)return 0;if(i)return-1;if(a)return 1}return r}(e.upper,t.upper,e.upperOpen,t.upperOpen)}(K.req.query.range,w.query.range)}),!1,k,E];case"count":return[O=E.find(function(K){return Er(K.req.query.range,w.query.range)}),!!O,k,E]}}(t,n,"query",a),v=h[0],l=h[1],b=h[2],d=h[3];return v&&l?v.obsSet=a.obsSet:(l=r.query(a).then(function(y){var m=y.result;if(v&&(v.res=m),s){for(var g=0,w=m.length;g<w;++g)Object.freeze(m[g]);Object.freeze(m)}else y.result=De(m);return y}).catch(function(y){return d&&v&&Ie(d,v),Promise.reject(y)}),v={obsSet:a.obsSet,promise:l,subscribers:new Set,type:"query",req:a,dirty:!1},d?d.push(v):(d=[v],(b=b||(tt["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[a.query.index.name||""]=d)),function Qr(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){var i,a;e.subscribers.delete(n),0===e.subscribers.size&&(i=e,a=t,setTimeout(function(){0===i.subscribers.size&&Ie(a,i)},3e3))})}(v,d,u,f),v.promise.then(function(y){return{result:Sr(y.result,a,b?.optimisticOps,r,v,s)}})}})}})}};function sn(e,t){return new Proxy(e,{get:function(n,r,i){return"db"===r?t:Reflect.get(n,r,i)}})}var Fe=(se.prototype.version=function(e){if(isNaN(e)||e<.1)throw new B.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new B.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(r){return r._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(Br),n.stores({}),this._state.autoSchema=!1,n)},se.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||q.letThrough||this._vip)?e():new T(function(n,r){if(t._state.openComplete)return r(new B.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void r(new B.DatabaseClosed);t.open().catch(Z)}t._state.dbReadyPromise.then(n,r)}).then(e)},se.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;return i&&this.unuse({stack:t,name:i}),(e=this._middlewares[t]||(this._middlewares[t]=[])).push({stack:t,create:n,level:r??10,name:i}),e.sort(function(a,s){return a.level-s.level}),this},se.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(i){return r?i.create!==r:!!n&&i.name!==n})),this},se.prototype.open=function(){var e=this;return Ze(ae,function(){return zr(e)})},se.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=ct.indexOf(this);if(0<=t&&ct.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new T(function(n){e.dbReadyResolve=n}),e.openCanceller=new T(function(n,r){e.cancelOpen=r}))},se.prototype.close=function(n){var t=(void 0===n?{disableAutoOpen:!0}:n).disableAutoOpen;n=this._state,t?(n.isBeingOpened&&n.cancelOpen(new B.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new B.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},se.prototype.delete=function(e){var t=this;void 0===e&&(e={disableAutoOpen:!0});var n=0<arguments.length&&"object"!=typeof arguments[0],r=this._state;return new T(function(i,a){function s(){t.close(e);var u=t._deps.indexedDB.deleteDatabase(t.name);u.onsuccess=ne(function(){var f,h,v;h=t.name,v=(f=t._deps).indexedDB,f=f.IDBKeyRange,Cn(v)||h===Gt||In(v,f).delete(h).catch(Z),i()}),u.onerror=Ae(a),u.onblocked=t._fireOnBlocked}if(n)throw new B.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})},se.prototype.backendDB=function(){return this.idbdb},se.prototype.isOpen=function(){return null!==this.idbdb},se.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},se.prototype.hasFailed=function(){return null!==this._state.dbOpenError},se.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(se.prototype,"tables",{get:function(){var e=this;return F(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),se.prototype.transaction=function(){var e=function(t,n,r){var i=arguments.length;if(i<2)throw new B.InvalidArgument("Too few arguments");for(var a=new Array(i-1);--i;)a[i-1]=arguments[i];return r=a.pop(),[t,We(a),r]}.apply(this,arguments);return this._transaction.apply(this,e)},se.prototype._transaction=function(e,t,n){var r=this,i=q.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var a,s,u=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(s=t.map(function(h){if("string"!=typeof(h=h instanceof r.Table?h.name:h))throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),"r"==e||e===wn)a=wn;else{if("rw"!=e&&e!=xn)throw new B.InvalidArgument("Invalid transaction mode: "+e);a=xn}if(i){if(i.mode===wn&&a===xn){if(!u)throw new B.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach(function(h){if(i&&-1===i.storeNames.indexOf(h)){if(!u)throw new B.SubTransaction("Table "+h+" not included in parent transaction.");i=null}}),u&&i&&!i.active&&(i=null)}}catch(h){return i?i._promise(null,function(v,l){l(h)}):oe(h)}var f=function h(v,l,b,d,y){return T.resolve().then(function(){var m=q.transless||q,g=v._createTransaction(l,b,v._dbSchema,d);if(g.explicit=!0,m={trans:g,transless:m},d)g.idbtrans=d.idbtrans;else try{g.create(),g.idbtrans._explicit=!0,v._state.PR1398_maxLoop=3}catch(E){return E.name===It.InvalidState&&v.isOpen()&&0<--v._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),v.close({disableAutoOpen:!1}),v.open().then(function(){return h(v,l,b,null,y)})):oe(E)}var w,k=gt(y);return k&&ut(),m=T.follow(function(){var E;(w=y.call(g,g))&&(k?(E=Ue.bind(null,null),w.then(E,E)):"function"==typeof w.next&&"function"==typeof w.throw&&(w=Bn(w)))},m),(w&&"function"==typeof w.then?T.resolve(w).then(function(E){return g.active?E:oe(new B.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):m.then(function(){return w})).then(function(E){return d&&g._resolve(),g._completion.then(function(){return E})}).catch(function(E){return g._reject(E),oe(E)})})}.bind(null,this,a,s,i,n);return i?i._promise(a,f,"lock"):q.trans?Ze(q.transless,function(){return r._whenReady(f)}):this._whenReady(f)},se.prototype.table=function(e){if(!ue(this._allTables,e))throw new B.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},se);function se(e,t){var n=this;this._middlewares={},this.verno=0;var r=se.dependencies;this._options=t=L({addons:se.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},r=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var i,a,s,u,f,h={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Z,dbReadyPromise:null,cancelOpen:Z,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};h.dbReadyPromise=new T(function(l){h.dbReadyResolve=l}),h.openCanceller=new T(function(l,b){h.cancelOpen=b}),this._state=h,this.name=e,this.on=wt(this,"populate","blocked","versionchange","close",{ready:[at,Z]}),this.once=function(l,b){var d=function(){for(var y=[],m=0;m<arguments.length;m++)y[m]=arguments[m];n.on(l).unsubscribe(d),b.apply(n,y)};return n.on(l,d)},this.on.ready.subscribe=it(this.on.ready.subscribe,function(l){return function(b,d){se.vip(function(){var y,m=n._state;m.openComplete?(m.dbOpenError||T.resolve().then(b),d&&l(b)):m.onReadyBeingFired?(m.onReadyBeingFired.push(b),d&&l(b)):(l(b),y=n,d||l(function g(){y.on.ready.unsubscribe(b),y.on.ready.unsubscribe(g)}))})}}),this.Collection=(i=this,xt(Cr.prototype,function(w,g){this.db=i;var d=er,y=null;if(g)try{d=g()}catch(k){y=k}var m=w._ctx;this._ctx={table:g=m.table,index:m.index,isPrimKey:!m.index||g.schema.primKey.keyPath&&m.index===g.schema.primKey.name,range:d,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:y,or:m.or,valueMapper:(w=g.hook.reading.fire)!==je?w:null}})),this.Table=(a=this,xt(or.prototype,function(l,b,d){this.db=a,this._tx=d,this.name=l,this.schema=b,this.hook=a._allTables[l]?a._allTables[l].hook:wt(null,{creating:[Tt,Z],reading:[jt,je],updating:[yn,Z],deleting:[bt,Z]})})),this.Transaction=(s=this,xt(Tr.prototype,function(l,b,d,y,m){var g=this;"readonly"!==l&&b.forEach(function(w){(w=null===(w=d[w])||void 0===w?void 0:w.yProps)&&(b=b.concat(w.map(function(k){return k.updatesTable})))}),this.db=s,this.mode=l,this.storeNames=b,this.schema=d,this.chromeTransactionDurability=y,this.idbtrans=null,this.on=wt(this,"complete","error","abort"),this.parent=m||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new T(function(w,k){g._resolve=w,g._reject=k}),this._completion.then(function(){g.active=!1,g.on.complete.fire()},function(w){var k=g.active;return g.active=!1,g.on.error.fire(w),g.parent?g.parent._reject(w):k&&g.idbtrans&&g.idbtrans.abort(),oe(w)})})),this.Version=(u=this,xt(Ur.prototype,function(l){this.db=u,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(f=this,xt(fr.prototype,function(l,b,d){if(this.db=f,this._ctx={table:l,index:":id"===b?null:b,or:d},this._cmp=this._ascending=Q,this._descending=function(y,m){return Q(m,y)},this._max=function(y,m){return 0<Q(y,m)?y:m},this._min=function(y,m){return Q(y,m)<0?y:m},this._IDBKeyRange=f._deps.IDBKeyRange,!this._IDBKeyRange)throw new B.MissingAPI})),this.on("versionchange",function(l){0<l.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(l){!l.newVersion||l.newVersion<l.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(l.oldVersion/10))}),this._maxKey=Et(t.IDBKeyRange),this._createTransaction=function(l,b,d,y){return new n.Transaction(l,b,d,n._options.chromeTransactionDurability,y)},this._fireOnBlocked=function(l){n.on("blocked").fire(l),ct.filter(function(b){return b.name===n.name&&b!==n&&!b._state.vcFired}).map(function(b){return b.on("versionchange").fire(l)})},this.use(Hr),this.use(Xr),this.use(Yr),this.use(Gr),this.use(Vr);var v=new Proxy(this,{get:function(l,b,d){if("_vip"===b)return!0;if("table"===b)return function(m){return sn(n.table(m),v)};var y=Reflect.get(l,b,d);return y instanceof or?sn(y,v):"tables"===b?y.map(function(m){return sn(m,v)}):"_createTransaction"===b?function(){return sn(y.apply(this,arguments),v)}:y}});this.vip=v,r.forEach(function(l){return l(n)})}xe=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";var un,Zr=(zn.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})},zn.prototype[xe]=function(){return this},zn);function zn(e){this._subscribe=e}try{un={indexedDB:A.indexedDB||A.mozIndexedDB||A.webkitIndexedDB||A.msIndexedDB,IDBKeyRange:A.IDBKeyRange||A.webkitIDBKeyRange}}catch{un={indexedDB:null,IDBKeyRange:null}}function Or(e){var t,n=!1,r=new Zr(function(i){var s,a=gt(e),u=!1,f={},h={},v={get closed(){return u},unsubscribe:function(){u||(u=!0,s&&s.abort(),l&&Ve.storagemutated.unsubscribe(d))}};i.start&&i.start(v);var l=!1,b=function(){return _n(y)},d=function(m){rn(f,m),Tn(h,f)&&b()},y=function(){var m,g,w;!u&&un.indexedDB&&(f={},m={},s&&s.abort(),s=new AbortController,w=function(k){var E=ot();try{a&&ut();var O=$e(e,k);return O=a?O.finally(Ue):O}finally{E&&st()}}(g={subscr:m,signal:s.signal,requery:b,querier:e,trans:null}),Promise.resolve(w).then(function(k){n=!0,t=k,u||g.signal.aborted||(f={},function(E){for(var O in E)if(ue(E,O))return;return 1}(h=m)||l||(Ve(St,d),l=!0),_n(function(){return!u&&i.next&&i.next(k)}))},function(k){n=!1,["DatabaseClosedError","AbortError"].includes(k?.name)||u||_n(function(){u||i.error&&i.error(k)})}))};return setTimeout(b,0),v});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var nt=Fe;function Gn(e){var t=He;try{He=!0,Ve.storagemutated.fire(e),Nn(e,!0)}finally{He=t}}ke(nt,L(L({},Le),{delete:function(e){return new nt(e,{addons:[]}).delete()},exists:function(e){return new nt(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return n=(t=nt.dependencies).indexedDB,t=t.IDBKeyRange,(Cn(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==Gt})}):In(n,t).toCollection().primaryKeys()).then(e)}catch{return oe(new B.MissingAPI)}var t,n},defineClass:function(){return function(e){ie(this,e)}},ignoreTransaction:function(e){return q.trans?Ze(q.transless,e):e()},vip:Rn,async:function(e){return function(){try{var t=Bn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:T.resolve(t)}catch(n){return oe(n)}}},spawn:function(e,t,n){try{var r=Bn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:T.resolve(r)}catch(i){return oe(i)}},currentTransaction:{get:function(){return q.trans||null}},waitFor:function(e,t){return t=T.resolve("function"==typeof e?nt.ignoreTransaction(e):e).timeout(t||6e4),q.trans?q.trans.waitFor(t):t},Promise:T,debug:{get:function(){return we},set:function(e){qt(e)}},derive:Ne,extend:ie,props:ke,override:it,Events:wt,on:Ve,liveQuery:Or,extendObservabilitySet:rn,getByKeyPath:Se,setByKeyPath:he,delByKeyPath:function(e,t){"string"==typeof t?he(e,t,void 0):"length"in t&&[].map.call(t,function(n){he(e,n,void 0)})},shallowClone:Kt,deepClone:De,getObjectDiff:Ln,cmp:Q,asap:yt,minKey:-1/0,addons:[],connections:ct,errnames:It,dependencies:un,cache:tt,semVer:"4.2.1",version:"4.2.1".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),nt.maxKey=Et(nt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ve(St,function(e){He||(e=new CustomEvent(En,{detail:e}),He=!0,dispatchEvent(e),He=!1)}),addEventListener(En,function(e){e=e.detail,He||Gn(e)}));var dt,He=!1,Pr=function(){};return typeof BroadcastChannel<"u"&&((Pr=function(){(dt=new BroadcastChannel(En)).onmessage=function(e){return e.data&&Gn(e.data)}})(),"function"==typeof dt.unref&&dt.unref(),Ve(St,function(e){He||dt.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Fe.disableBfCache&&e.persisted){we&&console.debug("Dexie: handling persisted pagehide"),dt?.close();for(var t=0,n=ct;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Fe.disableBfCache&&e.persisted&&(we&&console.debug("Dexie: handling persisted pageshow"),Pr(),Gn({all:new pe(-1/0,[[]])}))})),T.rejectionMapper=function(e,t){return!e||e instanceof ce||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Rt[e.name]?e:(t=new Rt[e.name](t||e.message,e),"stack"in e&&Pe(t,"stack",{get:function(){return this.inner.stack}}),t)},qt(we),L(Fe,Object.freeze({__proto__:null,Dexie:Fe,liveQuery:Or,Entity:tr,cmp:Q,PropModification:_t,replacePrefix:function(e,t){return new _t({replacePrefix:[e,t]})},add:function(e){return new _t({add:e})},remove:function(e){return new _t({remove:e})},default:Fe,RangeSet:pe,mergeRanges:At,rangesOverlap:mr}),{default:Fe}),Fe}()},6885:(ln,Ye,L)=>{"use strict";L.d(Ye,{$F:()=>Xe,GW:()=>A,O_:()=>_e,Uw:()=>U});var U=(S=>(S[S.New=0]="New",S[S.Learning=1]="Learning",S[S.Review=2]="Review",S[S.Relearning=3]="Relearning",S))(U||{}),A=(S=>(S[S.Manual=0]="Manual",S[S.Again=1]="Again",S[S.Hard=2]="Hard",S[S.Good=3]="Good",S[S.Easy=4]="Easy",S))(A||{});class F{static card(o){return{...o,state:F.state(o.state),due:F.time(o.due),last_review:o.last_review?F.time(o.last_review):void 0}}static rating(o){if("string"==typeof o){const c=o.charAt(0).toUpperCase(),p=o.slice(1).toLowerCase(),_=A[`${c}${p}`];if(void 0===_)throw new Error(`Invalid rating:[${o}]`);return _}if("number"==typeof o)return o;throw new Error(`Invalid rating:[${o}]`)}static state(o){if("string"==typeof o){const c=o.charAt(0).toUpperCase(),p=o.slice(1).toLowerCase(),_=U[`${c}${p}`];if(void 0===_)throw new Error(`Invalid state:[${o}]`);return _}if("number"==typeof o)return o;throw new Error(`Invalid state:[${o}]`)}static time(o){const c=new Date(o);if("object"==typeof o&&null!==o&&!Number.isNaN(Date.parse(o)||+c))return c;if("string"==typeof o){const p=Date.parse(o);if(Number.isNaN(p))throw new Error(`Invalid date:[${o}]`);return new Date(p)}if("number"==typeof o)return new Date(o);throw new Error(`Invalid date:[${o}]`)}static review_log(o){return{...o,due:F.time(o.due),rating:F.rating(o.rating),state:F.state(o.state),review:F.time(o.review)}}}function W(S,o,c){return new Date(c?F.time(S).getTime()+24*o*60*60*1e3:F.time(S).getTime()+60*o*1e3)}function ie(S,o,c){if(!S||!o)throw new Error("Invalid date");const p=F.time(S).getTime()-F.time(o).getTime();let _=0;switch(c){case"days":_=Math.floor(p/864e5);break;case"minutes":_=Math.floor(p/6e4)}return _}function qe(S){return S<10?`0${S}`:`${S}`}Date.prototype.scheduler=function(S,o){return W(this,S,o)},Date.prototype.diff=function(S,o){return ie(this,S,o)},Date.prototype.format=function(){return function Ke(S){const o=F.time(S),c=o.getFullYear(),p=o.getMonth()+1,_=o.getDate(),x=o.getHours(),P=o.getMinutes(),j=o.getSeconds();return`${c}-${qe(p)}-${qe(_)} ${qe(x)}:${qe(P)}:${qe(j)}`}(this)},Date.prototype.dueFormat=function(S,o,c){return function pt(S,o,c,p=ke){S=F.time(S),o=F.time(o),p.length!==ke.length&&(p=ke);let _=S.getTime()-o.getTime(),x=0;for(_/=1e3,x=0;x<ue.length&&!(_<ue[x]);x++)_/=ue[x];return`${Math.floor(_)}${c?p[x]:""}`}(this,S,o,c)};const ue=[60,60,24,31,12],ke=["second","min","hour","day","month","year"],Mt=Object.freeze([A.Again,A.Hard,A.Good,A.Easy]),Be=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function re(S,o,c){return Math.min(Math.max(S,o),c)}const Se=S=>{const o=S.slice(-1),c=parseInt(S.slice(0,-1),10);if(Number.isNaN(c)||!Number.isFinite(c)||c<0)throw new Error(`Invalid step value: ${S}`);switch(o){case"m":return c;case"h":return 60*c;case"d":return 1440*c;default:throw new Error(`Invalid step unit: ${S}, expected m/h/d`)}},he=(S,o,c)=>{const p=o===U.Relearning||o===U.Review?S.relearning_steps:S.learning_steps,_=p.length;if(0===_||c>=_)return{};const x=p[0],P=Se,$=()=>{if(1===_)return Math.round(1.5*P(x));const te=p[1];return Math.round((P(x)+P(te))/2)},V=te=>te<0||te>=_?null:p[te],ae={},q=V(Math.max(0,c));if(o===U.Review)return ae[A.Again]={scheduled_minutes:P(q),next_step:0},ae;{ae[A.Again]={scheduled_minutes:P(x),next_step:0},ae[A.Hard]={scheduled_minutes:$(),next_step:c};const te=V(c+1);if(te){const de=(te=>P(te))(te);de&&(ae[A.Good]={scheduled_minutes:Math.round(de),next_step:c+1})}}return ae};function Kt(){return`${this.review_time.getTime()}_${this.current.reps}_${this.current.difficulty*this.current.stability}`}var We=(S=>(S.SCHEDULER="Scheduler",S.LEARNING_STEPS="LearningSteps",S.SEED="Seed",S))(We||{});class mt{last;current;review_time;next=new Map;algorithm;strategies;elapsed_days=0;constructor(o,c,p,_){this.algorithm=p,this.last=F.card(o),this.current=F.card(o),this.review_time=F.time(c),this.strategies=_,this.init()}checkGrade(o){if(!Number.isFinite(o)||o<0||o>4)throw new Error(`Invalid grade "${o}",expected 1-4`)}init(){const{state:o,last_review:c}=this.current;let p=0;o!==U.New&&c&&(p=function yt(S,o){const c=Date.UTC(S.getUTCFullYear(),S.getUTCMonth(),S.getUTCDate()),p=Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate());return Math.floor((p-c)/864e5)}(c,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=p,this.current.elapsed_days=p,this.current.reps+=1;let _=Kt;if(this.strategies){const x=this.strategies.get(We.SEED);x&&(_=x)}this.algorithm.seed=_.call(this)}preview(){return{[A.Again]:this.review(A.Again),[A.Hard]:this.review(A.Hard),[A.Good]:this.review(A.Good),[A.Easy]:this.review(A.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const o of Mt)yield this.review(o)}review(o){const{state:c}=this.last;let p;switch(this.checkGrade(o),c){case U.New:p=this.newState(o);break;case U.Learning:case U.Relearning:p=this.learningState(o);break;case U.Review:p=this.reviewState(o)}return p}buildLog(o){const{last_review:c,due:p,elapsed_days:_}=this.last;return{rating:o,state:this.current.state,due:c||p,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:_,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}class Qe{c;s0;s1;s2;constructor(o){const c=function De(){let S=4022871197;return function(c){c=String(c);for(let p=0;p<c.length;p++){S+=c.charCodeAt(p);let _=.02519603282416938*S;S=_>>>0,_-=S,_*=S,S=_>>>0,_-=S,S+=4294967296*_}return 2.3283064365386963e-10*(S>>>0)}}();this.c=1,this.s0=c(" "),this.s1=c(" "),this.s2=c(" "),null==o&&(o=Date.now()),this.s0-=c(o),this.s0<0&&(this.s0+=1),this.s1-=c(o),this.s1<0&&(this.s1+=1),this.s2-=c(o),this.s2<0&&(this.s2+=1)}next(){const o=2091639*this.s0+2.3283064365386963e-10*this.c;return this.s0=this.s1,this.s1=this.s2,this.c=0|o,this.s2=o-this.c,this.s2}set state(o){this.c=o.c,this.s0=o.s0,this.s1=o.s1,this.s2=o.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}const Oe=Object.freeze(["1m","10m"]),gt=Object.freeze(["10m"]),ce=.001,Ct=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,.1542]),Le=(S,o,c=!0)=>{let p=2;return Math.max(0,o)>1&&(p=re(+(-(Math.log(S[11])+Math.log(Math.pow(2,S[13])-1)+.3*S[14])/o).toFixed(8),.01,2)),((S,o=!0)=>[[ce,100],[ce,100],[ce,100],[ce,100],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,S],[0,S],[o?.01:0,.8],[.1,.8]])(p,c).slice(0,S.length).map(([x,P],j)=>re(S[j]||0,x,P))},je=(S,o=0,c=!0)=>{if(void 0===S)return[...Ct];switch(S.length){case 21:return Le(Array.from(S),o,c);case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),Le(Array.from(S),o,c).concat([0,.5]);case 17:{const p=Le(Array.from(S),o,c);return p[4]=+(2*p[5]+p[4]).toFixed(8),p[5]=+(Math.log(3*p[5]+1)/3).toFixed(8),p[6]=+(p[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),p.concat([0,0,0,.5])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...Ct]}},jt=S=>{const o=Array.isArray(S?.learning_steps)?S.learning_steps:Oe,c=Array.isArray(S?.relearning_steps)?S.relearning_steps:gt,p=S?.enable_short_term??!0,_=je(S?.w,c.length,p);return{request_retention:S?.request_retention||.9,maximum_interval:S?.maximum_interval||36500,w:_,enable_fuzz:S?.enable_fuzz??!1,enable_short_term:p,learning_steps:o,relearning_steps:c}};function _e(S,o){const c={due:S?F.time(S):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:U.New,last_review:void 0};return o&&"function"==typeof o?o(c):c}const Tt=S=>{const o="number"==typeof S?-S:-S[20];return{decay:o,factor:+(Math.exp(Math.pow(o,-1)*Math.log(.9))-1).toFixed(8)}};function bt(S,o,c){const{decay:p,factor:_}=Tt(S);return+Math.pow(1+_*o/c,p).toFixed(8)}class yn{param;intervalModifier;_seed;constructor(o){this.param=new Proxy(jt(o),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=bt.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(o){this._seed=o}calculate_interval_modifier(o){if(o<=0||o>1)throw new Error("Requested retention rate should be in the range (0,1]");const{decay:c,factor:p}=Tt(this.param.w);return+((Math.pow(o,1/c)-1)/p).toFixed(8)}get parameters(){return this.param}set parameters(o){this.update_parameters(o)}params_handler_proxy(){const o=this;return{set:function(c,p,_){return"request_retention"===p&&Number.isFinite(_)?o.intervalModifier=o.calculate_interval_modifier(Number(_)):"w"===p&&(_=je(_,c.relearning_steps.length,c.enable_short_term),o.forgetting_curve=bt.bind(this,_),o.intervalModifier=o.calculate_interval_modifier(Number(c.request_retention))),Reflect.set(c,p,_),!0}}}update_parameters(o){const c=jt(o);for(const p in c)this.param[p]=c[p]}init_stability(o){return Math.max(this.param.w[o-1],.1)}init_difficulty(o){return+(this.param.w[4]-Math.exp((o-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(o,c){if(!this.param.enable_fuzz||o<2.5)return Math.round(o);const _=function hn(S){const o=new Qe(S),c=()=>o.next();return c.int32=()=>4294967296*o.next()|0,c.double=()=>c()+11102230246251565e-32*(2097152*c()|0),c.state=()=>o.state,c.importState=p=>(o.state=p,c),c}(this._seed)(),{min_ivl:x,max_ivl:P}=function it(S,o,c){let p=1;for(const P of Be)p+=P.factor*Math.max(Math.min(S,P.end)-P.start,0);S=Math.min(S,c);let _=Math.max(2,Math.round(S-p));const x=Math.min(Math.round(S+p),c);return S>o&&(_=Math.max(_,o+1)),_=Math.min(_,x),{min_ivl:_,max_ivl:x}}(o,c,this.param.maximum_interval);return Math.floor(_*(P-x+1)+x)}next_interval(o,c){const p=Math.min(Math.max(1,Math.round(o*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(p,c)}linear_damping(o,c){return+(o*(10-c)/9).toFixed(8)}next_difficulty(o,c){const _=o+this.linear_damping(-this.param.w[6]*(c-3),o);return re(this.mean_reversion(this.init_difficulty(A.Easy),_),1,10)}mean_reversion(o,c){return+(this.param.w[7]*o+(1-this.param.w[7])*c).toFixed(8)}next_recall_stability(o,c,p,_){const x=A.Hard===_?this.param.w[15]:1,P=A.Easy===_?this.param.w[16]:1;return+re(c*(1+Math.exp(this.param.w[8])*(11-o)*Math.pow(c,-this.param.w[9])*(Math.exp((1-p)*this.param.w[10])-1)*x*P),ce,36500).toFixed(8)}next_forget_stability(o,c,p){return+re(this.param.w[11]*Math.pow(o,-this.param.w[12])*(Math.pow(c+1,this.param.w[13])-1)*Math.exp((1-p)*this.param.w[14]),ce,36500).toFixed(8)}next_short_term_stability(o,c){const p=Math.pow(o,-this.param.w[19])*Math.exp(this.param.w[17]*(c-3+this.param.w[18]));return+re(o*(c>=3?Math.max(p,1):p),ce,36500).toFixed(8)}forgetting_curve;next_state(o,c,p){const{difficulty:_,stability:x}=o??{difficulty:0,stability:0};if(c<0)throw new Error(`Invalid delta_t "${c}"`);if(p<0||p>4)throw new Error(`Invalid grade "${p}"`);if(0===_&&0===x)return{difficulty:re(this.init_difficulty(p),1,10),stability:this.init_stability(p)};if(0===p)return{difficulty:_,stability:x};if(_<1||x<ce)throw new Error(`Invalid memory state { difficulty: ${_}, stability: ${x} }`);const P=this.forgetting_curve(c,x),j=this.next_recall_stability(_,x,P,p),$=this.next_forget_stability(_,x,P),V=this.next_short_term_stability(x,p);let J=j;if(1===p){let[q,te]=[0,0];this.param.enable_short_term&&(q=this.param.w[17],te=this.param.w[18]),J=re(+(x/Math.exp(q*te)).toFixed(8),ce,$)}return 0===c&&this.param.enable_short_term&&(J=V),{difficulty:this.next_difficulty(_,p),stability:J}}}class Ft extends mt{learningStepsStrategy;constructor(o,c,p,_){super(o,c,p,_);let x=he;if(this.strategies){const P=this.strategies.get(We.LEARNING_STEPS);P&&(x=P)}this.learningStepsStrategy=x}getLearningInfo(o,c){const p=this.algorithm.parameters;o.learning_steps=o.learning_steps||0;const _=this.learningStepsStrategy(p,o.state,this.current.state===U.Learning&&c!==A.Again&&c!==A.Hard?o.learning_steps+1:o.learning_steps);return{scheduled_minutes:Math.max(0,_[c]?.scheduled_minutes??0),next_steps:Math.max(0,_[c]?.next_step??0)}}applyLearningSteps(o,c,p){const{scheduled_minutes:_,next_steps:x}=this.getLearningInfo(this.current,c);if(_>0&&_<1440)o.learning_steps=x,o.scheduled_days=0,o.state=p,o.due=W(this.review_time,Math.round(_),!1);else if(o.state=U.Review,_>=1440)o.learning_steps=x,o.due=W(this.review_time,Math.round(_),!1),o.scheduled_days=Math.floor(_/1440);else{o.learning_steps=0;const P=this.algorithm.next_interval(o.stability,this.elapsed_days);o.scheduled_days=P,o.due=W(this.review_time,P,!0)}}newState(o){const c=this.next.get(o);if(c)return c;const p=F.card(this.current);p.difficulty=re(this.algorithm.init_difficulty(o),1,10),p.stability=this.algorithm.init_stability(o),this.applyLearningSteps(p,o,U.Learning);const _={card:p,log:this.buildLog(o)};return this.next.set(o,_),_}learningState(o){const c=this.next.get(o);if(c)return c;const{state:p,difficulty:_,stability:x}=this.last,P=F.card(this.current);P.difficulty=this.algorithm.next_difficulty(_,o),P.stability=this.algorithm.next_short_term_stability(x,o),this.applyLearningSteps(P,o,p);const j={card:P,log:this.buildLog(o)};return this.next.set(o,j),j}reviewState(o){const c=this.next.get(o);if(c)return c;const p=this.elapsed_days,{difficulty:_,stability:x}=this.last,P=this.algorithm.forgetting_curve(p,x),j=F.card(this.current),$=F.card(this.current),V=F.card(this.current),J=F.card(this.current);this.next_ds(j,$,V,J,_,x,P),this.next_interval($,V,J,p),this.next_state($,V,J),this.applyLearningSteps(j,A.Again,U.Relearning),j.lapses+=1;const ae={card:j,log:this.buildLog(A.Again)},q={card:$,log:super.buildLog(A.Hard)},te={card:V,log:super.buildLog(A.Good)},de={card:J,log:super.buildLog(A.Easy)};return this.next.set(A.Again,ae),this.next.set(A.Hard,q),this.next.set(A.Good,te),this.next.set(A.Easy,de),this.next.get(o)}next_ds(o,c,p,_,x,P,j){o.difficulty=this.algorithm.next_difficulty(x,A.Again);const $=P/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),V=this.algorithm.next_forget_stability(x,P,j);o.stability=re(+$.toFixed(8),ce,V),c.difficulty=this.algorithm.next_difficulty(x,A.Hard),c.stability=this.algorithm.next_recall_stability(x,P,j,A.Hard),p.difficulty=this.algorithm.next_difficulty(x,A.Good),p.stability=this.algorithm.next_recall_stability(x,P,j,A.Good),_.difficulty=this.algorithm.next_difficulty(x,A.Easy),_.stability=this.algorithm.next_recall_stability(x,P,j,A.Easy)}next_interval(o,c,p,_){let x,P;x=this.algorithm.next_interval(o.stability,_),P=this.algorithm.next_interval(c.stability,_),x=Math.min(x,P),P=Math.max(P,x+1);const j=Math.max(this.algorithm.next_interval(p.stability,_),P+1);o.scheduled_days=x,o.due=W(this.review_time,x,!0),c.scheduled_days=P,c.due=W(this.review_time,P,!0),p.scheduled_days=j,p.due=W(this.review_time,j,!0)}next_state(o,c,p){o.state=U.Review,o.learning_steps=0,c.state=U.Review,c.learning_steps=0,p.state=U.Review,p.learning_steps=0}}class at extends mt{newState(o){const c=this.next.get(o);if(c)return c;this.current.scheduled_days=0,this.current.elapsed_days=0;const p=F.card(this.current),_=F.card(this.current),x=F.card(this.current),P=F.card(this.current);return this.init_ds(p,_,x,P),this.next_interval(p,_,x,P,0),this.next_state(p,_,x,P),this.update_next(p,_,x,P),this.next.get(o)}init_ds(o,c,p,_){o.difficulty=re(this.algorithm.init_difficulty(A.Again),1,10),o.stability=this.algorithm.init_stability(A.Again),c.difficulty=re(this.algorithm.init_difficulty(A.Hard),1,10),c.stability=this.algorithm.init_stability(A.Hard),p.difficulty=re(this.algorithm.init_difficulty(A.Good),1,10),p.stability=this.algorithm.init_stability(A.Good),_.difficulty=re(this.algorithm.init_difficulty(A.Easy),1,10),_.stability=this.algorithm.init_stability(A.Easy)}learningState(o){return this.reviewState(o)}reviewState(o){const c=this.next.get(o);if(c)return c;const p=this.elapsed_days,{difficulty:_,stability:x}=this.last,P=this.algorithm.forgetting_curve(p,x),j=F.card(this.current),$=F.card(this.current),V=F.card(this.current),J=F.card(this.current);return this.next_ds(j,$,V,J,_,x,P),this.next_interval(j,$,V,J,p),this.next_state(j,$,V,J),j.lapses+=1,this.update_next(j,$,V,J),this.next.get(o)}next_ds(o,c,p,_,x,P,j){o.difficulty=this.algorithm.next_difficulty(x,A.Again);const $=this.algorithm.next_forget_stability(x,P,j);o.stability=re(P,ce,$),c.difficulty=this.algorithm.next_difficulty(x,A.Hard),c.stability=this.algorithm.next_recall_stability(x,P,j,A.Hard),p.difficulty=this.algorithm.next_difficulty(x,A.Good),p.stability=this.algorithm.next_recall_stability(x,P,j,A.Good),_.difficulty=this.algorithm.next_difficulty(x,A.Easy),_.stability=this.algorithm.next_recall_stability(x,P,j,A.Easy)}next_interval(o,c,p,_,x){let P,j,$,V;P=this.algorithm.next_interval(o.stability,x),j=this.algorithm.next_interval(c.stability,x),$=this.algorithm.next_interval(p.stability,x),V=this.algorithm.next_interval(_.stability,x),P=Math.min(P,j),j=Math.max(j,P+1),$=Math.max($,j+1),V=Math.max(V,$+1),o.scheduled_days=P,o.due=W(this.review_time,P,!0),c.scheduled_days=j,c.due=W(this.review_time,j,!0),p.scheduled_days=$,p.due=W(this.review_time,$,!0),_.scheduled_days=V,_.due=W(this.review_time,V,!0)}next_state(o,c,p,_){o.state=U.Review,o.learning_steps=0,c.state=U.Review,c.learning_steps=0,p.state=U.Review,p.learning_steps=0,_.state=U.Review,_.learning_steps=0}update_next(o,c,p,_){const x={card:o,log:this.buildLog(A.Again)},P={card:c,log:super.buildLog(A.Hard)},j={card:p,log:super.buildLog(A.Good)},$={card:_,log:super.buildLog(A.Easy)};this.next.set(A.Again,x),this.next.set(A.Hard,P),this.next.set(A.Good,j),this.next.set(A.Easy,$)}}class we{fsrs;constructor(o){this.fsrs=o}replay(o,c,p){return this.fsrs.next(o,c,p)}handleManualRating(o,c,p,_,x,P,j){if(typeof c>"u")throw new Error("reschedule: state is required for manual rating");let $,V;if(c===U.New)$={rating:A.Manual,state:c,due:j??p,stability:o.stability,difficulty:o.difficulty,elapsed_days:_,last_elapsed_days:o.elapsed_days,scheduled_days:o.scheduled_days,learning_steps:o.learning_steps,review:p},V=_e(p),V.last_review=p;else{if(typeof j>"u")throw new Error("reschedule: due is required for manual rating");const J=ie(j,p,"days");$={rating:A.Manual,state:o.state,due:o.last_review||o.due,stability:o.stability,difficulty:o.difficulty,elapsed_days:_,last_elapsed_days:o.elapsed_days,scheduled_days:o.scheduled_days,learning_steps:o.learning_steps,review:p},V={...o,state:c,due:j,last_review:p,stability:x||o.stability,difficulty:P||o.difficulty,elapsed_days:_,scheduled_days:J,reps:o.reps+1}}return{card:V,log:$}}reschedule(o,c){const p=[];let _=_e(o.due);for(const x of c){let P;if(x.review=F.time(x.review),x.rating===A.Manual){let j=0;_.state!==U.New&&_.last_review&&(j=ie(x.review,_.last_review,"days")),P=this.handleManualRating(_,x.state,x.review,j,x.stability,x.difficulty,x.due?F.time(x.due):void 0)}else P=this.replay(_,x.review,x.rating);p.push(P),_=P.card}return p}calculateManualRecord(o,c,p,_){if(!p)return null;const{card:x,log:P}=p,j=F.card(o);return j.due.getTime()===x.due.getTime()?null:(j.scheduled_days=ie(x.due,j.due,"days"),this.handleManualRating(j,x.state,F.time(c),P.elapsed_days,_?x.stability:void 0,_?x.difficulty:void 0,x.due))}}class qt extends yn{strategyHandler=new Map;Scheduler;constructor(o){super(o);const{enable_short_term:c}=this.parameters;this.Scheduler=c?Ft:at}params_handler_proxy(){const o=this;return{set:function(c,p,_){return"request_retention"===p&&Number.isFinite(_)?o.intervalModifier=o.calculate_interval_modifier(Number(_)):"enable_short_term"===p?o.Scheduler=!0===_?Ft:at:"w"===p&&(_=je(_,c.relearning_steps.length,c.enable_short_term),o.forgetting_curve=bt.bind(this,_),o.intervalModifier=o.calculate_interval_modifier(Number(c.request_retention))),Reflect.set(c,p,_),!0}}}useStrategy(o,c){return this.strategyHandler.set(o,c),this}clearStrategy(o){return o?this.strategyHandler.delete(o):this.strategyHandler.clear(),this}getScheduler(o,c){return new(this.strategyHandler.get(We.SCHEDULER)||this.Scheduler)(o,c,this,this.strategyHandler)}repeat(o,c,p){const x=this.getScheduler(o,c).preview();return p&&"function"==typeof p?p(x):x}next(o,c,p,_){const x=this.getScheduler(o,c),P=F.rating(p);if(P===A.Manual)throw new Error("Cannot review a manual rating");const j=x.review(P);return _&&"function"==typeof _?_(j):j}get_retrievability(o,c,p=!0){const _=F.card(o);c=c?F.time(c):new Date;const x=_.state!==U.New?Math.max(ie(c,_.last_review,"days"),0):0,P=_.state!==U.New?this.forgetting_curve(x,+_.stability.toFixed(8)):0;return p?`${(100*P).toFixed(2)}%`:P}rollback(o,c,p){const _=F.card(o),x=F.review_log(c);if(x.rating===A.Manual)throw new Error("Cannot rollback a manual rating");let P,j,$;switch(x.state){case U.New:P=x.due,j=void 0,$=0;break;case U.Learning:case U.Relearning:case U.Review:P=x.review,j=x.due,$=_.lapses-(x.rating===A.Again&&x.state===U.Review?1:0)}const V={..._,due:P,stability:x.stability,difficulty:x.difficulty,elapsed_days:x.last_elapsed_days,scheduled_days:x.scheduled_days,reps:Math.max(0,_.reps-1),lapses:Math.max(0,$),learning_steps:x.learning_steps,state:x.state,last_review:j};return p&&"function"==typeof p?p(V):V}forget(o,c,p=!1,_){const x=F.card(o);c=F.time(c);const P=x.state===U.New?0:ie(c,x.due,"days"),j={rating:A.Manual,state:x.state,due:x.due,stability:x.stability,difficulty:x.difficulty,elapsed_days:0,last_elapsed_days:x.elapsed_days,scheduled_days:P,learning_steps:x.learning_steps,review:c},V={card:{...x,due:c,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:p?0:x.reps,lapses:p?0:x.lapses,learning_steps:0,state:U.New,last_review:x.last_review},log:j};return _&&"function"==typeof _?_(V):V}reschedule(o,c=[],p={}){const{recordLogHandler:_,reviewsOrderBy:x,skipManual:P=!0,now:j=new Date,update_memory_state:$=!1}=p;x&&"function"==typeof x&&c.sort(x),P&&(c=c.filter(de=>de.rating!==A.Manual));const V=new we(this),J=V.reschedule(p.first_card||_e(),c),ae=J.length,q=F.card(o),te=V.calculateManualRecord(q,j,ae?J[ae-1]:void 0,$);return _&&"function"==typeof _?{collections:J.map(_),reschedule_item:te?_(te):null}:{collections:J,reschedule_item:te}}}const Xe=S=>new qt(S||{})}}]);